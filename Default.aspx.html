HTTP/2 200 
cache-control: private
content-type: text/html; charset=utf-8
set-cookie: ASP.NET_SessionId=cq2qvwe5pbrenmoxj0op1ubc; path=/; secure; HttpOnly; SameSite=Strict
set-cookie: ASP.NET_SessionId=cq2qvwe5pbrenmoxj0op1ubc; path=/; secure; HttpOnly; SameSite=Strict
set-cookie: __AntiXsrfToken=228e5848ddc0419496d3757f0880874f; path=/; secure; HttpOnly; SameSite=Strict
set-cookie: ASP.NET_SessionId=cq2qvwe5pbrenmoxj0op1ubc; path=/; secure; HttpOnly; SameSite=Strict
set-cookie: __AntiXsrfToken=228e5848ddc0419496d3757f0880874f; path=/; secure; HttpOnly; SameSite=Strict
set-cookie: SERVER=KACYOBACK2PROD; path=/; HttpOnly; SameSite=Strict; secure
access-control-allow-headers: Origin, X-Requested-With, Content-Type, Accept, Authorization
access-control-allow-methods: GET,PUT,POST,DELETE,OPTIONS
access-control-allow-credentials: true
access-control-allow-private-network: true
x-frame-options: SAMEORIGIN
x-content-type-options: nosniff
x-xss-protection: 1; mode=block
access-control-allow-origin: *
content-security-policy: base-uri 'self'; default-src 'self'; frame-ancestors 'self'; script-src 'self' 'unsafe-eval' 'nonce-kacyonet' *.8x8.vc 8x8.vc https://8x8.vc *.googleapis.com googleapis.com https://maps.googleapis.com/; style-src 'self' 'unsafe-inline' *.googleapis.com googleapis.com https://maps.googleapis.com/ https://fonts.googleapis.com/ *.gstatic.com gstatic.com https://fonts.gstatic.com/; object-src 'none'; img-src * data: blob: 'unsafe-inline'; frame-src 'self' *.youtube.com youtube.com https://www.youtube.com *.genial.ly genial.ly https://view.genial.ly *.8x8.vc 8x8.vc https://8x8.vc; connect-src 'self' *.googleapis.com googleapis.com https://maps.googleapis.com/; upgrade-insecure-requests
referrer-policy: origin-when-cross-origin
permissions-policy: accelerometer=(), gyroscope=(), magnetometer=(), payment=(), usb=()
date: Sat, 08 Mar 2025 14:16:00 GMT
content-length: 210794
strict-transport-security: max-age=31536000;



<!-- Zabbix Auth String -->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" /><meta name="apple-mobile-web-app-capable" content="yes" /><meta name="apple-mobile-web-app-status-bar-style" content="black" /><meta name="description" /><meta name="author" /><link rel="icon" href="../images/img/logosi.png" /><title>
	Impulse Sign-IN
</title>

    <script nonce="kacyonet" type="text/javascript">
        if ((navigator.userAgent.indexOf("MSIE ") > -1 || navigator.userAgent.indexOf("Trident/") > -1) && window.location.href.indexOf('IE.aspx') < 0 && window.location.href.indexOf('Assess/Player/Default.aspx') < 0) {
            var encoded = encodeURIComponent(window.location.href);
            window.location.href = '/IE.aspx?uri=' + encoded;
        }
    </script>

    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../css/bootstrap/js/bootstrap.min.js"></script>
    <script nonce="kacyonet">$.fn.bsTooltip = $.fn.tooltip</script>
    <script type="text/javascript" src="../js/jquery-ui/jquery-ui.min.js"></script>
    <script nonce="kacyonet">$.fn.tooltip = $.fn.bsTooltip</script>
    <script type="text/javascript" src="../js/jquery-ui/jquery.ui.touch-punch.min.js"></script>
    <script type="text/javascript" src="../js/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="../js/klms.js?v=4.2.1.20"></script>
    <script type="text/javascript" src="../js/validator/validator.modif.js"> </script>
    <script type="text/javascript" src="../js/mustache.js"></script>
    <script type="text/javascript" src="../js/bootstrap-multiselect/multiple-select.min.js"></script>
    <script type="text/javascript" src="../js/bootstrap-multiselect/multiple-select-locale-all.min.js"></script>

    <script type="text/javascript" src="../js/rating/jquery.rateyo.js"></script>


    <script type="text/javascript" src="../js/fabric.min.js"></script>

    <script type="text/javascript" src="../Scripts/jquery.signalR-2.4.3.min.js"></script>
    <!-- Reference the autogenerated SignalR hub script. -->
    <script type="text/javascript" src="../signalr/hubs"></script>
    <!-- CustomForm -->
    <script type="text/javascript" src="../CustomFormJs.aspx"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" href="../css/bootstrap/css/bootstrap.min.css" />
    <!-- Font Awesome -->
    <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css" />-->
    <link rel="stylesheet" type="text/css" href="../css/fontawesome-5.15.4/css/all.min.css" />
    <!-- Ionicons -->
    <link rel="stylesheet" type="text/css" href="../css/ionicons/css/ionicons.css" />
    <!-- Multiselect -->
    <link rel="stylesheet" type="text/css" href="../js/bootstrap-multiselect/multiple-select.min.css" />
	<link rel="stylesheet" type="text/css" href="../js/bootstrap-multiselect/themes/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/master.css" />
    <link rel="stylesheet" type="text/css" href="../css/masterportalsi.css" />
    <link rel="stylesheet" type="text/css" href="../css/portal-impulse.css" />
    <!-- RateYo -->
    <link rel="stylesheet" type="text/css" href="../js/rating/jquery.rateyo.css" />
    <!-- jQuery UI -->
    <link rel="stylesheet" type="text/css" href="../js/jquery-ui/jquery-ui.min.css" />

    <script nonce="kacyonet" type="text/javascript">
        var autofill = setInterval(function (timestamp) {
            if (Date.now() - timestamp < 5000) {
                try {
                    jQuery('input:-internal-autofill-previewed:not(.enableAutofill), input:-internal-autofill-selected:not(.enableAutofill), textarea:-internal-autofill-previewed, textarea:-internal-autofill-selected, select:-internal-autofill-previewed, select:-internal-autofill-selected').val('');
                } catch (err) {}
            }
            else
                clearInterval(autofill);
        }, 10, Date.now());
        jsRelativePath = '../';
        const RelativeUrlPath = '../';

        var domainInfos;

        ajaxRequestSync('GET', '../api/ShortDomain/1').then(function (domain) {
            domainInfos = domain;
        });

        jQuery(document).ready(function () {
            translator.relativePath = '../';
            translator.domainId = 1;
            translator.defaultLang = 2;

            translator.init();
            translator.load();
        });
    </script>
<link href="../css/appli_horiba.css?v4.2.1.3" rel="stylesheet" type="text/css" /><script type="text/javascript" src="/js/appli_horiba.js?4.2.1.2"></script></head>

<body>
    <form method="post" action="./Default.aspx" id="form1" style="height: 100%;" novalidate="" autocomplete="false">
<div class="aspNetHidden">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="7B7q4WqxsRexizzH8+xX4+XAXZOXaqCnPllUwnwuDK/rqjdkpWB0HLDWw86G2eKbvNprk0p30zGHYnqPry8oFWrqYZ2G+pz9bVJ3Ywt65u3H12fJuIAZMbi8ndwEXIukP/HhswVRZp93f+5TLwv0dYde/acsPslSsJiEsOpyHTh9t3WyZ3s0FNEwwqKmQiz9AlpzhhjKcBUFKaLPKxbdJpS2yMGvgTrfNZ4WKpseCKMKa+9SSlZUfSYRgGRgjHdTkwshx8IQvqZnpeAx9S78FWedtkqpygqkukV9j7BGXmXChPtb6x3KV4S4LRRWHgenIoWpLBePWQPw6RY0XdeorMKcz3Zua4HTqb4Wzm+G1DzLBJHsUvTILIr/37qKEeZ2wNvJmMYbGs4olPSV77IIJrc+PcPBO+o5ze6U2cASmJbhJX0/mZ46OiZ6bpYO5UADNUS5GZkWNlDSDuji4CNMVBuulJblTbhBGAemm5Mjh1Zy+9f47FLhrym2CRF9CGDxEzvq/Od+JEfUT6dZcxLsGCa/2ZZ1yR6pLLCTk0r9xsFB5+YqIxm6+oljD9ZBGuwk4jbfCShlow1M1zt7gU0k4Gk4RpkuHyCOwK7fR1KKcjQaIXClNVFJxYVwf8tcL45Bgi76gMT5VpEoZdLk3SmLoa4MWJmQjpmiZtgDi4BB2bo8hN7Fykrrit+PsVGQTAOT9RcigLbVTuat4GcoWL+1FFn6NlqexO1B2xq/NK2vKG7nwcGEQlA3BrOHiRoInKcAsBigh+yr+IFi7edhr4iC5ZpniqytUZ8fFZfptesyyF1Ci5W7TyqT8xC7PNFrgdyC8L2qNljk0KRdoFTVA1Ko07dAR1VMItF9WShER7zTjA73S8fHcLBmLLTW60jyAVqaA2ox1gWfUcXnO3VFwpIs4P/d+d+8i2v2jVZdPbWsanttl9yW6mIswSl4xfF9UQJSMPxU2ITO4W0HdIYFAA0/cabBK3ReYYKi7gnTV7px3F4QIZngZzVQHiNdkq3iRjZN" />
</div>

<script type="text/javascript" nonce="kacyonet">window.currentLocale = 'en-US';moment.locale('en-US')</script>
<div class="aspNetHidden">

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="AAD87FE9" />
</div>
        
    <nav class="navbar navbar-default navbar-signin">
        <div class="container-fluid" style='margin-top: auto;margin-bottom: auto;'>
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navBarMenu">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">
                    <img src="https://horiba-re7.impulsesignin.com/AssetsLibrary/Domains/Horiba/HORIBA_logo last version .png" id="ContentPlaceHolderHeading_AppliLogo" class="AppliLogo img-responsive" />
                </a>
            </div>
            <div class="collapse navbar-collapse" id="navBarMenu">
                <ul id="navBarMenuLinks" class="nav navbar-nav">
                    <li class="active"><a href="#catalog">Trainings</a></li>
                    <li><a href="#news">News</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right" >
                    <li class="dropdown" style="display: none;">
                        <a href="#" class="dropdown-toggle text-center" data-toggle="dropdown"><img src="" id="navIconeLang"/></a>
                        <ul class="dropdown-menu" id="navListLang"></ul>
                    </li>
                    <li id="MenuNotConnected" event-onclick="loadConnexion()">
                        <a href="#" class="text-center" event-onclick="return false"><img src="/images/img/framed-portrait2.png" style="width: 32px;height: 32px;"/><br />Already member</a>
                    </li>
                    <li id="MenuConnected" class="dropdown hide">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#"><img src="/images/img/framed-portrait2.png" id="navIconeUser"/><span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li id="TrainerLinkMenu" style="display: none;"><a href="#" event-onclick="window.location.href='../Signin/InitTrainer.aspx';">Trainer portal</a></li>
                            <li id="AdminLinkMenu" style="display: none;"><a href="#" event-onclick="window.location.href='../HomePage.aspx';">Administration</a></li>
                            <li id="AccountManagerLinkMenu" style="display: none;"><a href="#" event-onclick="window.location.href='../HomeAccountManager.aspx';">Administrative management</a></li>
                            <li id="AdminOFLinkMenu" style="display: none;"><a href="#" event-onclick="window.location.href='../HomeAdminOF.aspx';">TO administration</a></li>
                            <li>
                                <a href="#" event-onclick="logout()">Logout</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <script nonce="kacyonet" type="text/javascript">
        const validMenu = () => {
            document.getElementById('MenuConnected').classList.toggle('hide', !sessionStorage.getItem(tokenKey))
            document.getElementById('MenuNotConnected').classList.toggle('hide', !!sessionStorage.getItem(tokenKey))
        }

        $(function () {
            validMenu()
			if (domainInfos.KEY == "LAWREA")
					$('#MenuNotConnected').hide();			
            $('html').css('scroll-behavior', 'smooth');
            $('#navBarMenuLinks').on('click', 'li', function (e) {
                $('#navBarMenuLinks li').removeClass('active');
                $(e.currentTarget).addClass('active');
            });
        });

        function logout() {
            ajaxRequest('GET', `${jsRelativePath}api/USERS/LOGOUT`).then(() => {
                sessionStorage.removeItem(tokenKey);
                sessionStorage.removeItem(PanelContentView);
                window.location.href = '/'
            })
        }
    </script>


        <div id="wrapper" class="portal">
            <div id="contentWrapper" style="display: none">
                <div class="container" style="padding-right: 0px;padding-left:0px;">
                    <div class="row">
                        
    <div id="ContentPlaceHolderBody_Default_Content">
	
<div id="HomeContent" is-main-frame></div>


<div id="PanAuthentication" style="display: none;">
    <div class="overlayScreen">
         <div class="overlayContent-30">
             <button type="button" class="close close-overlayScreen" event-onclick="jQuery('#PanAuthentication').hide();" aria-label="Close"><span aria-hidden="true">&times;</span></button>
             <div id="ContentPlaceHolderBody_ctl00_panFormAuthentication" class="form-authentication">
		

            

<!-- Zabbix Auth Form String -->

<style type="text/css">
    canvas{
      /*prevent interaction with the canvas*/
      pointer-events:none;
    }
</style>

<link rel="stylesheet" type="text/css" href="../css/fontawesome-5.15.4/css/all.min.css" />


 <div id="BoxIdent" class="centering text-center">
			
    <div style="margin-top: 20px; margin-bottom: 20px;">
        <img id="ContentPlaceHolderBody_ctl00_ctl03_ImgAppli" src="https://horiba-re7.impulsesignin.com/AssetsLibrary/Domains/Horiba/HORIBA_logo%20last%20version%20.png" style="max-width: 300px;" />
    </div>

    <div style="margin-top: 20px; margin-bottom: 20px;">
        <span style="font-weight:100;letter-spacing: 2px;font-size: 28px;"><span id="ContentPlaceHolderBody_ctl00_ctl03_LabAppliName"><span style="font-size: 18pt;" data-mce-style="font-size: 24pt;">IMPULSE </span><span style="color: #478cd0; font-size: 18pt;" data-mce-style="font-size: 24pt;">Sign-IN</span><br></span></span>
    </div>
    <div id="PanNormalAuth">
        <div id="panAuthLogin" class="form-group" data-button-default=".btn-primary">
				
            <div class="input-group col-lg-push-2 col-lg-8 col-md-push-2 col-md-8 col-sm-push-1 col-sm-10 col-xs-push-1 col-xs-10 LangLstAuthent" style="display: none;" >
                <span class="input-group-addon" id="addon-language"><i class="far fa-language"></i></span>
                <select name="ctl00$ContentPlaceHolderBody$ctl00$ctl03$LstLang" id="ContentPlaceHolderBody_ctl00_ctl03_LstLang" class="form-control " aria-describedby="addon-language">

				</select>
            </div>
            <div class="input-group col-lg-push-2 col-lg-8 col-md-push-2 col-md-8 col-sm-push-1 col-sm-10 col-xs-push-1 col-xs-10" style="margin-top: 10px;" >
                <span class="input-group-addon" id="addon-user" style="padding-left: 16px;padding-right: 15px;"><i class="fas fa-user"></i></span>
                <input name="ctl00$ContentPlaceHolderBody$ctl00$ctl03$UserId" type="text" size="20" id="UserId" class="form-control" MaxLenght="100" aria-describedby="addon-user" />
            </div>
            <div class="input-group col-lg-push-2 col-lg-8 col-md-push-2 col-md-8 col-sm-push-1 col-sm-10 col-xs-push-1 col-xs-10" style="margin-top: 10px;" >
                <span class="input-group-addon" id="addon-password" style="padding-left: 15px;padding-right: 15px;"><i class="fas fa-lock-alt"></i></span>
                <input name="ctl00$ContentPlaceHolderBody$ctl00$ctl03$UserPass" type="password" size="20" id="UserPass" class="form-control" MaxLenght="100" autocomplete="off" aria-describedby="addon-password" />
            </div>
            <div style="padding: 15px;">
                <span style="cursor: pointer;" event-onclick="jQuery('#modalForgottenPassword').modal('show');">Forgot password</span>
            </div>
            <div class="col-lg-push-1 col-lg-10 col-md-push-1 col-md-10 col-sm-push-1 col-sm-10 col-xs-push-1 col-xs-10" style="margin-top: 15px;margin-bottom: 10px;" >
                <button type="button" id="BtnValidLogin" class="btn btn-primary btn-log-choice btn-valid-login-form" style=" border-radius: 0px;" event-onclick="Authent_Valid();">OK</button>
            </div>
        
			</div>
        <br style="clear: both;" />
        
        
        <br style="clear: both;" />
        <div class="panel-group hide" id="panGetLoginWithSSO" role="tablist" aria-multiselectable="true" style="border-top: 1px solid #CFCFCF;margin: 5% 15% 0 15%; padding-top: 10px;"></div>
    </div>
    <div class="panel-group hide" id="panCapcha">
        <span>Maximum attempt reached.<br />Please re-enter the text below, respecting the lower and upper case letters.<br />The order of the characters does not matter.</span>
        <div id="captcha"></div>
        <div class="input-group" style="max-width: 250px; margin: 0 auto">
            <span class="input-group-addon" style="cursor: pointer" event-onclick="createCaptcha()"><i class="far fa-redo-alt"></i></span>
            <input id="captchaTextBox" type="text" class="form-control" placeholder="Captcha">
            <span class="input-group-addon" style="cursor: pointer" event-onclick="validateCaptcha()">Valid</span>
        </div>
    </div>

    <br style="clear: both;" />

     <p><span id="Msg" style="color:Red;font-family:Verdana;font-size:10pt;"></span></p>    

    <input type="hidden" id="hitTarget" />

     <div id="ContentPlaceHolderBody_ctl00_ctl03_HidePanSSO" class="hide">

			</div>

    <div class="modal fade" tabindex="-1" role="dialog" id="modalForgottenPassword">
        <div class="modal-dialog modal-forget-password" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span>&nbsp;&nbsp;Forgot password</h4>
            </div>
            <div class="modal-body">
                <p>Please enter your email in order to reset your password.</p>
            <div class="form-group">
                <div class="input-group">
                    <span class="input-group-addon"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span></span>
                    <input class="form-control" type="email" id="TxtMailForget" />
                </div>
            </div>
            </div>
            <div class="modal-footer">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center" style="padding-bottom:20px;">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" event-onclick="ForgetPaswwordValid();">Reset my password</button>
            </div>
            </div>
        </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

		</div>

<script nonce="kacyonet" type="text/javascript">
    var countErrorLog = 0;

    const createCaptcha = () => {
        jQuery('#panCapcha').removeClass('hide')
        jQuery('#PanNormalAuth').addClass('hide')
        jQuery('#captchaTextBox').val("")

        document.getElementById('captcha').innerHTML = ''
        const canv = document.createElement('canvas')
        canv.width = 250
        canv.height = 50
        const ctx = canv.getContext("2d")
        const img = new Image()
        img.onload = () => ctx.drawImage(img, 0, 0)
        img.src = `${jsRelativePath}captcha.ashx?${new Date().getTime()}`
        document.getElementById("captcha").appendChild(canv)
    }

    if (jQuery('#panAuthSAML').length || jQuery('#panAuthOIDC').length) {
        jQuery('#panGetLoginWithSSO').removeClass('hide');
        jQuery('#panGetLoginWithSSO').append(MakeCollapse({
            text: 'Login via username and password',
            parentId: 'panGetLoginWithSSO',
            expanded: false,
            id: 'panCollapsedGetLogin',
            titleClass: 'text-center',
            content: jQuery('<div/>', { id: 'panHostedLoginPassword' })
        }))

        if (jQuery('#panAuthSAML').length)
            jQuery('#panAuthSAML').prop('style', '')
        else
            jQuery('#panAuthOIDC').prop('style', '')

        jQuery('#panGetLoginWithSSO_Collapse_panCollapsedGetLogin').css('margin', '0px -25%')
        jQuery('#panAuthLogin').appendTo(jQuery('#panHostedLoginPassword'))
    }

    if (countErrorLog >= 5) {
        createCaptcha()
    }

    $(function () {

        jQuery('#modalForgottenPassword')
            .on('show.bs.modal', function (e) {
                var modal = $(this);
                var isOnly = modal.data('only') && true;

                if (isOnly) {
                    $('#BoxIdent').css('background', 'transparent');
                    $('#modalForgottenPassword').closest('[class*="overlayContent-"]').css('background', 'transparent').find('.close-overlayScreen').css('opacity', '0');
                    $('#BoxIdent').children(':not(#modalForgottenPassword)').css('opacity', '0');
                    $('#PanAuthentication').show();
                }
            })
            .on('hidden.bs.modal', function (e) {
                var modal = $(this);
                var isOnly = modal.data('only') && true;

                if (isOnly) {
                    $('#PanAuthentication').hide();
                    $('#BoxIdent').css('background', '');
                    $('#modalForgottenPassword').closest('[class*="overlayContent-"]').css('background', '').find('.close-overlayScreen').css('opacity', '');
                    $('#BoxIdent').children(':not(#modalForgottenPassword)').css('opacity', '');
                }

                modal.removeData('only');
            });
    });

    function Authent_SSO() {
        if (countErrorLog < 5) {
            var data = {
                'relay': jQuery('#hitTarget').val()
            }

            if (getUrlParameter('redirect'))
                data.redirect = getUrlParameter('redirect')

            ajaxRequest('POST', '/saml/connect/', data).then(function (answer) {

                if (answer.FORM)
                    jQuery('#ContentPlaceHolderBody_ctl00_ctl03_HidePanSSO').append(answer.FORM);

                var F = new Function(answer.EXEC);

                return (F());
            }, updateCntError);
        }
    }

    function Authent_OpenId() {
        if (countErrorLog < 5) {
            var data = {
                'relay': jQuery('#hitTarget').val()
            }

            if (getUrlParameter('redirect'))
                data.redirect = getUrlParameter('redirect')

            ajaxRequest('POST', '/openid/oidconnect/', data).then(function (answer) {

                if (answer.FORM)
                    jQuery('#ContentPlaceHolderBody_ctl00_ctl03_HidePanSSO').append(answer.FORM);

                var F = new Function(answer.EXEC);

                return (F());
            }, updateCntError);
        }
    }

    function Authent_Valid() {
        if (countErrorLog < 5) {
            sessionStorage.removeItem(tokenKey);
            var obj = new Object();
            obj.Login = jQuery('#UserId').val();
            obj.Password = jQuery('#UserPass').val();
            obj.Target = jQuery('#hitTarget').val();
            
            ajaxRequest('POST', '/api/USERS/LOGON', obj, true).then(function (answer) {
                if (answer.Status == 200) {
                    if (typeof PanelContentView != "undefined")
                        sessionStorage.removeItem(PanelContentView);

                    if (answer.Response.userName !== 'Empty')
                        sessionStorage.setItem(tokenKey, answer.Response.access_token);

                    
                    if (typeof isSwagger == "undefined") {
                        if (getUrlParameter('redirect'))
                            window.location.href = '/' + decodeURIComponent(getUrlParameter('redirect'));
                        else if (answer.Redirect !== null && answer.Redirect !== "")
                            window.location.href = '/' + answer.Redirect;
                    }
                    else {
                        parent.document.getElementById("input_apiKey").value = answer.Response.access_token
                        parent.document.getElementById("explore").click()
                        parent.document.getElementById(isSwagger).style.display = "none"
                        parent.document.getElementById(isSwagger).src = null
                    }
                }
                else if (answer.Status === 403 || answer.Status === 404) {
                    updateCntError()
                    jQuery('#Msg').html(answer.Error.Message);
                }
            }, (err) => {
                if(err.status == 400)
                    createCaptcha()
                else
                    updateCntError()
            });
        }
    }

    function Authent_Valid_Data(login, pwd, target) {
        if (countErrorLog < 5) {
            setTimeout(() => {
                sessionStorage.removeItem(tokenKey);
                var obj = new Object();
                obj.Login = login;
                obj.Password = pwd;
                obj.Target = target || jQuery('#hitTarget').val();
                
                ajaxRequest('POST', '/api/USERS/LOGON', obj, true).then(function (answer) {
                    if (answer.Status == 200) {
                        if (typeof PanelContentView != "undefined")
                            sessionStorage.removeItem(PanelContentView);

                        if (answer.Response.userName !== 'Empty')
                            sessionStorage.setItem(tokenKey, answer.Response.access_token);

                        if (answer.Redirect !== null && answer.Redirect !== "")
                            window.location.href = '/' + answer.Redirect;
                    }
                    else if (answer.Status === 403 || answer.Status === 404) {
                        updateCntError()
                        jQuery('#Msg').html(answer.Error.Message);
                    }
                }, updateCntError);
            }, 500)
        }
    }

    function ForgetPaswwordValid()
    {
        var obj = new Object();
        obj.Mail = jQuery('#TxtMailForget').val();
        obj.Target = jQuery('#hitTarget').val()
        ajaxRequest('POST', '/api/FORGOT_PASSWORD', obj, true).then(function (answer) {
            notify('Reset email sent');
            jQuery('#modalForgottenPassword').modal('hide');
        });
    }

    const updateCntError = () => {
        countErrorLog++

        if (countErrorLog >= 5) {
            createCaptcha()
        }
    }

    const validateCaptcha = () => {
        ajaxRequest('POST', `${jsRelativePath}captcha.ashx?_=${new Date().getTime()}&resolve=`, { code: document.getElementById('captchaTextBox').value }).then(
            (res) => {
                if (res === 'valid') {
                    countErrorLog = 0
                    jQuery('#PanNormalAuth').removeClass("hide")
                    jQuery('#panCapcha').addClass("hide")
                    notify("Valid entry")
                }
                else {
                    alert(`Invalid entry`)
                    createCaptcha()
                }
            },
            () => {
                alert(`Invalid entry`)
                createCaptcha()
            }
        )
    }
</script>
	</div>
         </div>
    </div>
</div>

<div id="HomeBusinessPortalControls" style="display: none;">

<script nonce="kacyonet" type="text/javascript">
    jQuery.cachedScript(`../modules/${(domainInfos.KEY.toLowerCase().indexOf("lawrea") > -1 ? "specifics/LAWREA" : "generics")}/ManageParamTraining.js`, "", false);	
</script>


<style>
a:hover,a:focus{
    outline: none;
    text-decoration: none;
}
.tab .nav-tabs{ border-bottom: 2px solid #e8e8e8; }
.tab .nav-tabs li a{
    display: block;
    padding: 10px 20px;
    margin: 0 5px 1px 0;
    background: #fff;
    font-size: 20px;
    font-weight: 700;
    color: #652703;
    text-align: center;
    border: none;
    border-radius: 0;
    z-index: 2;
    position: relative;
    transition:all 0.3s ease 0s;
}
.tab .nav-tabs li a:hover,
.tab .nav-tabs li.active a{
    color: #652703;
    border: none;
}
.tab .nav-tabs li.active a:before{
    content: "\f078";
    font-family: "Font Awesome 5 Pro";
    font-weight: 900;
    font-size: 25px;
    font-weight: 700;
    color: #652703;
    margin: 0 auto;
    position: absolute;
    bottom: -30px;
    left: 0;
    right: 0;
}
.tab .nav-tabs li.active a:after{
    content: "";
    width: 100%;
    height: 3px;
    background: #652703;
    position: absolute;
    bottom: -1px;
    left: 0;
    z-index: -1;
    transition: all 0.3s ease 0s;
}
.tab .tab-content{
    padding: 30px 20px 20px;
    margin-top: 0;
    background: #fff;
    font-size: 15px;
    color: #652703;
    line-height: 30px;
    border-radius: 0 0 5px 5px;
}
.tab .tab-content h3{
    font-size: 24px;
    margin-top: 0;
}
@media only screen and (max-width: 479px){
    .tab .nav-tabs li{
        width: 100%;
        text-align: center;
    }
    .tab .nav-tabs li.active a:before{
        content: "\f105";
        bottom: 15%;
        left: 0;
        right: auto;
    }
}

.img-Caption-new {
	box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
	width: 300px;
	height: 300px;
	text-align: center;
	cursor: pointer;
	margin: 5px;
}
</style>

<div id="mainContentBusiness" data-source="#mainContentBusiness">
    <main id="ContentPlaceHolderBody_ctl00_ctl00_main" class="main-homepage">

<!-- Contact -->
<section id="contact" class="mod-contact text-center">
    <h1 id="PanTitleContact">Contact us</h1>

    <div id="PanSubTitleContact">Leave us your contact information, a consultant will call you back</div>

    <article>
        <div class="form-group">
            <input type="text" id="contact-name" class="form-control" placeholder="Last name and first name">
        </div>
        <div class="form-group">
            <input type="email" id="contact-email" class="form-control" placeholder="Email">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="contact-phone" placeholder="Phone">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="contact-office" placeholder="Company">
        </div>
        <div class="form-group">
            <textarea class="form-control" id="contact-message" placeholder="Message"></textarea>
        </div>
        <button type="button" id="contact-send" class="btn btn-default btn-contact" style="border-radius: 0px;font-size: 110%" event-onclick="sendContactMail();">Send</button>
    </article>
</section>

<script nonce="kacyonet" type="text/javascript">
    function sendContactMail() {
        let bValidOK = true
        if ($('#contact-name').val() == '') {
            $('#contact-name').css('border', '1px red solid')
            bValidOK = false
        }
        if ($('#contact-email').val() == '') {
            $('#contact-email').css('border', '1px red solid')
            bValidOK = false
        }
        if ($('#contact-phone').val() == '') {
            $('#contact-phone').css('border', '1px red solid')
            bValidOK = false
        }

        if (bValidOK == false) {
            return alert("Please fill in the mandatory fields")
        }

        const strData = `
			Contact Us<br/><br/>
			Domain : ${$('#contact-office').val()}<br/>
			Last name and first name : ${$('#contact-name').val()}<br/>
			Email : ${$('#contact-email').val()}<br/>
			Phone : ${$('#contact-phone').val()}<br/><br/>
			${$('#contact-message').val().replace(/\n/g, '<br/>')}`

        ajaxRequest('POST', '/api/DOMAINs/SEND_REQUEST_INFO', strData).then(
            function () {
				$('[id^="contact-"]:not(button)').val('')
				alert(`Mail sent`)
            }
		)
    }
</script>

<!-- ActualitÃ© -->
<section id="news" class="mod-actuality">
    <h1>News</h1>

    <div class="articles"></div>
        <div class="row">    
            <div class="col-lg-12 PanNews">
                <div class="StickNews StickView">
            
                </div>
                <div class="StickNews ListView">

                </div>
            </div>
        </div>
    <div class="text-center">
        <button class="btn btn-nobg btn-more-news" style="border-radius: 0px;font-size: 110%" type="button" event-onclick="initNewsList();">More news</button>
        <button class="btn btn-primary btn-nobg btn-less-news" style="border-radius: 0px;font-size: 110%" type="button" event-onclick="initNewsStick();">Less news</button>
    </div>
</section>

<div id="panNewsDetail" style="display: none;">
		

<div class="overlayScreen">
    <div class="overlayContent-80">
        <button type="button" class="close close-overlayScreen" event-onclick="CloseNewsDetail();" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <div class="article-full">
            <div class="article-header row">
                <div class="thumb" style="float: left; margin-right: 20px;margin-bottom: 20px;">

                </div>
				<div>
					<h4 class="title h4-box" style="border-bottom: 1px solid #dddddd;">

					</h4>
                    <div class="article-content">

                    </div>
				</div>
            </div>            
        </div>
    </div>
</div>

<script nonce="kacyonet" type="text/javascript">
    function showNewsComplete(id) {
        jQuery('.thumb', '#panNewsDetail').empty();
        jQuery('.title', '#panNewsDetail').empty();
        jQuery('.article-content', '#panNewsDetail').empty();

        ajaxRequest('GET', '../api/ARTICLES_CONTENT/FULL/' + id).then(function (news) {
            jQuery('.thumb', '#panNewsDetail').append('<img src="' + news.IMAGE + '" style="max-height:200px;"/>');
            jQuery('.title', '#panNewsDetail').append(news.TITRE);
            jQuery('.article-content', '#panNewsDetail').append(news.CONTENT || news.SUMMARY);

            $('#panNewsDetail').show();
        });
    }

    function CloseNewsDetail() {
        $('#panNewsDetail').hide();
    }
</script>
	</div>
<div id="panTemplate" style="display: none;">
		

<script nonce="kacyonet" type="text/html-template" id="SkictCarouselTemplate">
    {{#Panels.length}}
    <div id="{{CarouselId}}" class="carousel slide" style="height: {{CarouselMinHeight}};">
        <ol class="carousel-indicators">
            {{#Panels}}
            <li data-target="#{{CarouselId}}" data-slide-to="{{Index}}" class="{{#isActive}}active{{/isActive}}"></li>
            {{/Panels}}
        </ol>
        <div class="carousel-inner" role="listbox">
            {{#Panels}}
            <div class="item {{#isActive}}active{{/isActive}}">
                {{#BlockItems}}
                <div class="{{BlockClass}}">
                    {{#Items}}
                    <div event-onclick="{{clickMethod}}" style="background-image: url('{{Image}}');" class="stick-carousel {{#summary}}stick-carousel-summary{{/summary}}">
                        <div class="caption-carousel">{{caption}}</div>
                        {{#summary}}
                        <div class="summary-carousel">
                            <div>{{{summary}}}</div>
                        </div>
                        {{/summary}}
                    </div>
                    {{/Items}}
                </div>
                {{/BlockItems}}
            </div>
            {{/Panels}}
        </div>
    </div>
    {{/Panels.length}}
    {{^Panels.length}}
    <div id="{{CarouselId}}">{{EmptyString}}</div>
    {{/Panels.length}}
</script>

<script nonce="kacyonet" type="text/html-template" id="ListInfoTemplate">
    <div id="{{ListId}}">
    {{#ListBlocks.length}}
        {{#isCollapsed}}
            <div class="panel-group {{ClassBlock}}" id="{{TypeBlock}}Accordion_{{IdBlock}}" role="tablist" aria-multiselectable="true">
        {{/isCollapsed}}
        {{#ListBlocks}}
                {{#isCollapsed}}
                <div class="panel-default">
                    <div class="panel-heading" role="tab" id="{{TypeBlock}}Header_{{IdBlock}}" data-toggle="collapse" data-parent="#{{TypeBlock}}Accordion_{{IdBlock}}"
                        data-target="#{{TypeBlock}}Collapse_{{IdBlock}}" aria-expanded="true">
                        <h4 class="panel-title">{{{BlockTitle}}}</h4>
                    </div>
                    <div id="{{TypeBlock}}Collapse_{{IdBlock}}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="{{TypeBlock}}Header_{{IdBlock}}">
                    {{/isCollapsed}}
                        <div class="row" style="margin-left: 20px;">
                            {{#ListItems}}  
                            <article class="{{ItemClass}}">
                                <div class="thumb">
                                    <img src="{{ImgItem}}">
                                </div>
                                <h4 class="title" event-onclick="{{FctItem}}">{{TitleItem}}</h4>
                                <div class="content">{{{ContentItem}}}</div>
                                <div class="link">
                                    {{{LinkItem}}}
                                </div>
                            </article>
                            {{/ListItems}}
                        </div>
                    {{#isCollapsed}}
                    </div>
                </div>
            {{/isCollapsed}}
        {{/ListBlocks}}
        {{#isCollapsed}}
            </div>
        {{/isCollapsed}}
    {{/ListBlocks.length}}
    {{^ListBlocks.length}}
    {{EmptyString}}
    {{/ListBlocks.length}}
    </div>
</script>
	</div>

<script nonce="kacyonet" type="text/javascript">
    function initNewsStick() {
        ajaxRequest('GET', '../api/ARTICLES_CONTENT/BUSINESS/NEWS/LIMIT/5').then(function (lst) {
            var data = new Object();

            if (lst.length === 0) {
                data.EmptyString = 'No pushed news';
                data.CarouselId = "News_Carousel";
                data.BlockItems = new Array();
            }
            else {
                var nbBlock = 0;

                jQuery.each(lst, function () {
                    nbBlock += parseInt(this.VISIBILITY_CAT);
                })

                var nbSlide = parseInt(nbBlock / 8) + (nbBlock % 8 >= 1 ? 1 : 0);
                
                data.CarouselId = "News_Carousel";
                data.CarouselMinHeight = '400px';
                data.Panels = new Array();

                var nbBlockSlide = [];

                for (var n = 1; n <= nbSlide; n++) {
                    var panel = new Object();
                    panel.Index = n - 1;
                    panel.isActive = n === 1;
                    panel.BlockItems = [];

                    nbBlockSlide[n] = 0;

                    var clonedArray = JSON.parse(JSON.stringify(lst));

                    jQuery.each(clonedArray, function (i, onew) {
                        if (parseInt(nbBlockSlide[n]) <= 8 && parseInt(nbBlockSlide[n]) + onew.VISIBILITY_CAT <= 8) {
                            panel.BlockItems.push({
                                BlockClass: (onew.VISIBILITY_CAT === 1 ? 'little-stick' : onew.VISIBILITY_CAT === 2 ? 'medium-stick' : 'large-stick'),
                                Priority: parseInt(onew.VISIBILITY_CAT),
                                Items: [
                                    {
                                        clickMethod: 'showNewsComplete(' + onew.ID + ');',
                                        Image: onew.IMAGE,
                                        caption: onew.TITRE,
                                        summary: '<span class="extra">' + moment(onew.DATE_PUBLICATION || onew.DATE_CREATION).format('LL') + '</span>' + onew.SUMMARY
                                    }
                                ]
                            });
                            nbBlockSlide[n] = parseInt(nbBlockSlide[n]) + onew.VISIBILITY_CAT;

                            jQuery.each(lst, function(j){
                                if(lst[j].ID === onew.ID) {
                                    lst.splice(j, 1);
                                    return false;
                                }
                            });
                        }
                    }); 

                    panel.BlockItems = panel.BlockItems.sort(function (a, b) { return b.Priority - a.Priority });

                    data.Panels.push(panel);
                }

                var template = jQuery('#SkictCarouselTemplate').html();

                Mustache.parse(template);

                var html = Mustache.render(template, data);
                jQuery('.mod-actuality .PanNews .StickNews.StickView').html(html).find('.summary-carousel > div').each(function () {
                    $(this).css('height', 'calc(100% - 1.1em)').after('<div class="extra">Read more</div>');
                });
            }

            jQuery('.btn-less-news').hide();
            jQuery('.btn-more-news').show();
            jQuery('.mod-actuality .PanNews .StickNews.StickView').show();
            jQuery('.mod-actuality .PanNews .StickNews.ListView').hide();
        });
    }

    function initNewsList() {
        ajaxRequest('GET', '../api/ARTICLES_CONTENT/BUSINESS/').then(function (lst) {
            var data = new Object();

            if (lst.length === 0) {
                data.EmptyString = 'No news to view';
                data.ListId = "News-List";
                data.ListBlocks = new Array();
            }
            else {
                
                data.ListId = "News-List";
                data.isCollapsed = false;
                data.ListBlocks = new Array();

                var block = new Object();
                block.ClassBlock = '';
                block.TypeBlock = '';
                block.IdBlock = 0;
                block.BlockTitle = ""

                block.ListItems = [];

                jQuery.each(lst, function () {
                    block.ListItems.push({
                        ItemClass: 'disbaleRow',
                        ImgItem: this.IMAGE,
                        FctItem: '',
                        TitleItem: this.TITRE,
                        ContentItem: this.SUMMARY,
                        LinkItem: '<span event-onclick="showNewsComplete(' + this.ID + ');">Read the article</span>'
                    });

                });

                data.ListBlocks.push(block);

                var template = jQuery('#ListInfoTemplate').html();

                Mustache.parse(template);

                var html = Mustache.render(template, data);
                jQuery('.mod-actuality .PanNews .StickNews.ListView').html(html);
            }

            jQuery('.btn-less-news').show();
            jQuery('.btn-more-news').hide();

            jQuery('.mod-actuality .PanNews .StickNews.StickView').hide();
            jQuery('.mod-actuality .PanNews .StickNews.ListView').show();
        });
    }

    initNewsStick();  
</script>

<!--Recherche -->
<section class="mod-search">

    <div class="engine" data-button-default=".btn-psearch">
        <div class="row">
            <div id='PanTitleSearch' class='text-center' style='margin-top: 70px;'></div>
            <div id='PanEngine' class="col-lg-offset-2 col-lg-8 col-md-offset-1 col-md-10 col-sm-offset-1 col-sm-10 col-xs-offset-1 col-xs-10" style='margin-top: 22px;'>
                <div class="input-group input-group-lg">
                    <input id="txtSearch" type="text" class="form-control" placeholder="Search a training">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default btn-psearch" event-onclick="searchClick();"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                    </span>
                </div><!-- /input-group -->
            </div><!-- /.col-lg-6 -->
        </div><!-- /.row -->
    </div>

</section>

<div id="PanSearchResult" style="display: none;">
    <div class="overlayScreen">
         <div class="overlayContent-60">
             <button type="button" class="close close-overlayScreen" event-onclick="jQuery('#PanSearchResult').hide();" aria-label="Close"><span aria-hidden="true">&times;</span></button>
             <div class="result-details">

            </div>
         </div>
    </div>
</div>

<script nonce="kacyonet" type="text/javascript">
    function searchClick() {
        var datas = new Object();
        datas.TYPE_SEARCH = 'SINGLE TABLE';
        datas.RESPONSE = '{"ID" : [#TRAINING_ID#] , "NAME" : "[#NAME#]"}';
        datas.DATA_SEARCH = {
            'NAME': jQuery('#txtSearch').val(),
            'DOMAIN_ID' : 1
        };
        datas.TABLE = 'TRAINING';

        ajaxRequest('POST', '../api/HUB/SEARCH/ENGIN?ref=SearchCatalog', datas).then(function (results) {
            jQuery('#PanSearchResult .result-details').empty();

            if (results.DATA.length > 0) {
                jQuery.each(results.DATA, function (i, resultData) {
                    var result = JSON.parse(resultData);
                    ajaxRequest('GET', '../api/TRAINING/Detail/' + result.ID).then(function (oTraining) {
                        jQuery('#PanSearchResult .result-details').append('<div class="training-row" event-onclick="jQuery(\'#PanSearchResult\').hide();showTrainingDetail(' + oTraining.TRAINING_ID + ');">' +
                            '<div class="col-lg-9 col-md-8 col-sm-8 col-xs-8"><div class="name">' + oTraining.NAME + '</div>' +
                            '<div class="description">' + oTraining.DESCR + '</div></div > ' +
                            '<div class="col-lg-3 col-md-4 col-sm-4 col-xs-4 text-right"><div class="type">' + oTraining.TYPE_TRAINING + '</div>' +
                            '<div class="duration">' + oTraining.TRAINING_DURATION + '</div></div>' +
                            '</div > ');
                    });
                });
            }
            else {
                jQuery('#PanSearchResult .result-details').append('<div class="training-row">' +
                            '<div class="col-lg-12"><div class="name">No training found</div></div > ' +
                            '</div > ');
            }

            jQuery('#PanSearchResult').show();
        });
    }
</script>

<!-- Formation -->
<section id="catalog" class="mod-training" style="margin-top: 15px;">
    <div id='PanTitleTraining' class='text-center'><h1>Trainings domains</h1></div>

    <article>
        <div class="folders">
            <ul></ul>
        </div>

        <div class="details" >
        </div>
    </article>
</section>


<link rel="stylesheet" href="../js/jquery.slick/slick.css" />
<link rel="stylesheet" href="../js/jquery.slick/slick-theme.css" />
<script type="text/javascript" src="../js/jquery.slick/slick.min.js"></script>
<script nonce="kacyonet" type="text/javascript">

	var viewTrainingLoader = new ajaxAdvancedLoader();

	function InitCatalogTrainee()
	{
		if ($('.mod-training .folders ul li').length == 0)
		{
			return ajaxRequest('GET', '../api/DOMAIN_TRAINING/WITH_TRAINING').then(function (lst) {
				jQuery('.mod-training .folders ul').empty();
				jQuery.each(lst, function (i, dTraining) {
					var $Li = $("<li id='" + dTraining.DOM_TRAINING_ID + "' class='col-lg-3 col-md-3 col-sm-4 col-xs-6 li-img-Caption'></li>");
					jQuery('.mod-training .folders ul').append($Li);
					var $Div = $("<div id='Pan_" + dTraining.DOM_TRAINING_ID + "' class='img-Caption' event-onclick='showTrainings2(this);' data-target='" + dTraining.DOM_TRAINING_ID + "'></div>");

					if (dTraining.IMG_URL == null || dTraining.IMG_URL == '')
					{
						strImg = "/images/img/addimg.png";
					}
					else
					{
						strImg = dTraining.IMG_URL;
					}
					$Img = $("<div style='width: 100%; height: 200px; background: #ffffff;'><img src='" + strImg + "' class='img-Caption2' style='margin-left: auto; margin-right: auto;'></div>");
					$Div.append($Img);
					$DivCaption = $("<div id='PanNameDom_" + dTraining.DOM_TRAINING_ID + "' class='txt-Caption dynamic-field'>" + dTraining.NAME + "</div>");
					$Div.append($DivCaption);
					$Li.append($Div);
				});
				
				
				$('.mod-training .folders ul').slick({
					infinite: false,
					slidesToShow: 1,
					slidesToScroll: 1,
					responsive: 'unslick',
					variableWidth: true,
					mobileFirst: true,
					arrows: false,
					dots: true,
					responsive: [
						{
						  breakpoint: 1024,
						  settings: {
							slidesToShow: 4,
							slidesToScroll: 4
						  }
						},
						{
						  breakpoint: 600,
						  settings: {
							slidesToShow: 2,
							slidesToScroll: 2
						  }
						},
						{
						  breakpoint: 480,
						  settings: {
							slidesToShow: 1,
							slidesToScroll: 1
						  }
						}
					]
				});

			});
			
		}
		else
			return null;
	}
	
    function showTrainings2(obj) {
        var self = jQuery(obj);
        var id = self.data('target');

        jQuery('.folder-selected', '.folders').remove();

        self.append('<div class="folder-selected"><span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span><div>');

        jQuery('.mod-training .details').empty().show().css('height', '64px');

        viewTrainingLoader.init({
            'loader': 'hlaf_spin',
            'theme': 'dark',
            'size': 5,
            'target': '.mod-training .details',
        });

        ajaxRequest('GET', '../api/TRAINING/Detail_Folder/' + id).then(function (lst) {
            viewTrainingLoader.StopLoading();
            jQuery.each(lst, function (i, oTraining) {
                var strImg = "/images/img/addimg.png";
                if (typeof oTraining.IMG_URL !== 'undefined' && oTraining.IMG_URL != null && oTraining.IMG_URL != '')
                    strImg = oTraining.IMG_URL;

                jQuery('.mod-training .details').css('height','').append('<div class="training-row" event-onclick="showTrainingDetail(' + oTraining.TRAINING_ID + ');"  style="padding-left:15px;">' +
                    '<div class="col-lg-1 col-md-1 col-sm-2 col-xs-2" style="padding:0px;"><img src="' + strImg + '" style="width: auto;height: 44px;margin-right: 5px"></div>' +
                    '<div class="col-lg-8 col-md-8 col-sm-7 col-xs-7"><div class="name"><span class="dynamic-field">' + oTraining.NAME + '</span>' + (oTraining.NB_CLASSES ? ' <small style="color#888; font-size: 0.75em;margin-left: 3em;">[##NB_CLASSES##] available session(s)</small>'.replace('[##NB_CLASSES##]', oTraining.NB_CLASSES) : '') + '</div>' +
                    '<div class="description">' + oTraining.DESCR + '</div></div > ' +
                    '<div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-right"><div class="type">' + oTraining.TYPE_TRAINING + '</div>' +
                    '<div class="duration">' + oTraining.TRAINING_DURATION + '</div></div>' +
                    '</div > ');
            });
        });
    }

    jQuery(document).ready(function () {
        jQuery('.slick-track').each(function (i, item) {
            item.style.width = "100%";
        });
    })
</script></main>
		<div id='PanLstElemPage' class='body-model' style='border: none;text-align: center;display: none;' data-type='body-model'></div>
		<div id='PanAppendStyle'></div>
		
	
</div>

<!-- Popup d'affichage d'un other elem -->
<div class="modal fade" id="PopOtherElem" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <div id="PanPopOtherElem"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<input type='hidden' id='HiTypePage' value='1'>


<script nonce="kacyonet" type="text/javascript">

	var ResolveUrl = "/";
	var ImgAdd = "/images/img/addimg.png";
	
	var strButNews = "More news";
	var strButNews2 = "Less news";
	var strEmptyNews = 'No pushed news';
	var strNews1 = "Read more";
	var strEmptyNews2 = "No news to view";
	var strShowNews = "Read the article";
	var strTitleTraining = "Bloc";
	var strTitleTraining2 = "List";
	var strLnkTraining = "Access training";
	var strTraining1 = "[##NB_CLASSES##] available session(s)";
	var strTraining2 = "No training in progress";
	var strTraining3 = "No training in the history";
	var EnrollUserOk = "1";
	var PropYourSearch = "Your search";
	var PropDateStart = "Between";
	var PropDateEnd = "And";
	var PropLoc = "City / place";
	var PropTrainer = "Trainer";
	var PropSearch = "Search";
	var PropPlaceHolderSearch = "Enter a city or a postal code or a department";
	var PropOnline = "Distance";
	var PropRadiusSearch = "Radius search";
	var PropAllDomain = "See all training domains";
	var PropResultSearch ="Result search";
	var PropPresCV = "Face-to-face or distance";
	var PropElearning = "E-learning";
	var PropBlended = "Mixed";
	var PropViewTraining = "Discover the training";
	var PropAvailable = "Available seats";
	var PropLastPlace = "Last places";
	var PropNotAvailable = "No places available";
	var PropNextClass = "Next sessions";
	var PropNoClass = "There are no sessions available";
	var PropViewPlanning = "See the session schedule";
	var PropPlaceHolderTrainer = "Enter the first letters of the trainer's name and select from the list";
	var PropRespClass = "Organizer";
	var PropPlaceHolderRespClass = "Enter the first letters of the organizer's name and select from the list";
	var PropPole = "Training center";
	var PropPlaceHolderPole = "";
	var PropViewMap = "View training map";
	var PropTypeTraining = "Domain of âskill";
	
	var PropMyPosition = "Around me";
	var PropKm = "km";
	var PropValid = "Valid";
	var PropNoSelect = "-- Select --";
	var PropClassInRoom = "In room";
	var PropClassInVC = "In virtual classroom";
	var PropClassBlended = "Mixed";
	var PropClassElearning = "E-Learning";
	var PropEnroll2 = "Registration";
	var PropClear = "Delete";
	var PropNoResult = "No training found";
	
	var PropNewTraining = "Show paginate";
	var PropCatalog = "Show certificate signature";
	var PropCourse = "The training courses";
	var PropSelfService = "The self service";
	var PropNoDate = "No date set";
	var PropConsult = "Consult";
	
	
	
	var COURSE_PRES = 2;
	var COURSE_ELEARNING = 1;
	var COURSE_BLENDED = 3;
	var COURSE_VIRTUALCLASS = 4;
	var IN_VIRTUAL_CLASS = 2;
	
	var SESSION_STATUS_CREATE = 1;
	
	
	var IN_VIRTUAL_CLASS = 2;
	
	
	
	var oParams = JSON.parse(domainInfos.SIGNIN_SETTINGS || '{}');
	
	var ActiveDomain = "1";
	
	$(document).ready(function() 
	{
//		UserIdConnect = 0;
		if (typeof InitCatalogTrainee === "function")
			InitCatalogTrainee();
		Init();
	});
	
	
	

    var ObjLstElem = null;
    function Init()
    {
        var Param = domainInfos.ADVANCED_PARAM.PARAMPAGE_NO_CONNECT;
        if (typeof Param !== 'undefined' && Param != null && Param != "")
            ObjLstElem = JSON.parse(Param);

        if (ObjLstElem != null)
        {
            var Order = 1;

            $('.mod-search').hide();
            $('.mod-training').hide();
            $('.mod-actuality').hide();
            $('.mod-contact').hide();

            $.each(ObjLstElem, function (index, ObjElem) {
                ObjElem.ORDER_ID = index;
                switch (ObjElem.TYPE_ELEM)
                {
                    case '-1':
                        DisplayBackground(ObjElem);
                        break;
                    case '1':
                        // DisplayHearder(ObjElem);
                        break;
                    case '2':
                        DisplayDomTraining(ObjElem, Order);
                        Order++;
                        break;
                    case '3':
                        $('.mod-actuality').show();
                        break;
                    case '4':
                        DisplayContact(ObjElem, Order);
                        Order++;
                        break;
                    case '5':
                        DisplayFooter(ObjElem, Order);
                        break;
                    case '6':
                        DisplayOther(ObjElem, Order);
                        Order++;
                        break;
                }
            });
        }
    }

    function DisplayBackground(ObjElem)
    {
        if (ObjElem.BACK_IMG != "")
        {
            $('#HomeContent').css("background", "url(" + ObjElem.BACK_IMG + ") center");
            $('#HomeContent').css("background-size", "cover");
            $('#HomeContent').css("opacity", ObjElem.OPACITY);
        }
        else
        {
            if (ObjElem.BACK_COLOR != "")
                $('#HomeContent').css("background", ObjElem.BACK_COLOR);
            else
                $('#HomeContent').css("background", "#ffffff");
        }
    }

    function DisplayOther(ObjElem, Order)
    {
        var style = "order:" + Order + ";margin-left: 0px;margin-right:0px; margin-top:15px; margin-bottom:15px;";

        if (ObjElem.BACK_IMG != "")
        {
            style += "background: url(" + ObjElem.BACK_IMG + ") center;";
            style += "background-repeat:no-repeat;";
            style += "background-size: cover;";
            if (ObjElem.OPACITY != "")
                style += "opacity: " + ObjElem.OPACITY + ";";
        }
        else
        {
            if (ObjElem.TRANPARENT == "Y")
            {
                style += "background: transparent;";
            }
            else
            {
                if (ObjElem.BACK_COLOR != "")
                {
                    style += "background: " + ObjElem.BACK_COLOR + ";";
                    if (ObjElem.OPACITY != "")
                        style += "opacity: " + ObjElem.OPACITY + ";";
                }
                else
                {
                    style += "background: #ffffff;"
                }
            }
        }

        if (ObjElem.BORDER == "Y")
        {
            style += ObjElem.BORDER_TYPE;
        }

        if (ObjElem.SHADOW == "Y")
        {
            style += 'box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);';
        }

        var str="";
        str += "<section id='SecOther_" + ObjElem.ELEM_ID + "' style='text-align:center;" + style + "'>";

        // Titre
        str += "<div id='PanTitleElem_" + ObjElem.ELEM_ID + "' style='margin-left:10px;margin-right:10px;'>" + ObjElem.TITLE + "</div>";

        // Texte
        str += "<div id='PanTextElem_" + ObjElem.ELEM_ID + "' style='margin-top: 10px;margin-left:10px;margin-right:10px;'>" + ObjElem.CONTENT + "</div>";

        if (ObjElem.OPEN_POPUP == 'Y')
        {
            str += "<button id='ButPopOther_" + ObjElem.ELEM_ID + "' type='button' class='btn' event-onclick='OpenPopOther(" + ObjElem.ELEM_ID + ");' style='background: " + ObjElem.COLOR_BUTTON + ";padding-left: 15px;padding-right: 15px;padding-top: 8px;padding-bottom: 8px;font-size:110%;color:" + ObjElem.COLOR_TEXT_BUTTON + ";margin-top:10px;margin-bottom: -10px;border-radius: unset;'>" + ObjElem.TEXT_BUTTON + "</button>";

            str += "<input type='hidden' id='HiTextPopOther_" + ObjElem.ELEM_ID + "' value='" + ObjElem.TEXT_POPUP + "'>";
        }

        str += "</section>";

        $('.main-homepage').append(str);
    }

    function OpenPopOther(ElemId)
    {
        $('#PanPopOtherElem').html($('#HiTextPopOther_' + ElemId).val());
        // $('#PopOtherElem').modal('show');
        $('#PopOtherElem').appendTo("body").modal('show');
    }

    function DisplayDomTraining(ObjElem, Order)
    {
        $('.mod-search').show();
        $('.mod-training').show();

        // Recherche
        $('.mod-search').css('order', Order);
        if (ObjElem.BACK_IMG != "")
        {
            $('.mod-search').css("background", "url(" + ObjElem.BACK_IMG + ") center");
            $('.mod-search').css("background-size", "cover");
            // $('.mod-search').css("opacity", ObjElem.OPACITY);
        }
        else
        {
            if (ObjElem.BACK_COLOR != "")
            {
                $('.mod-search').css("background", ObjElem.BACK_COLOR);
            }
            else
            {
                if (ObjElem.TRANSPARENT == 'Y')
                    $('.mod-search').css("background", 'transparent');
                else
                    $('.mod-search').css("background", '#ffffff');
            }
        }

        if (ObjElem.HEIGHT != "")
        {
            $('.mod-search').css("height", ObjElem.HEIGHT);
        }
        $('.engine').css('margin-top', '45px');

        $('#PanTitleSearch').empty();
        $('#PanTitleSearch').html(ObjElem.TITLE_SEARCH);
        $('#PanTitleSearch').css('margin-bottom', '50px');
        $('#PanTitleSearch').css('text-shadow', '5px 3px 7px rgba(78, 78, 78, 0.9)');

        $('#PanTitleTraining').empty();
        $('#PanTitleTraining').html(ObjElem.TITLE_DOMAIN);
    }

    function DisplayContact(ObjElem, Order)
    {
        $('.mod-contact').show();

        $('.mod-contact').css('order', Order);
        if (ObjElem.BACK_IMG != "")
        {
            $('.mod-contact').css("background", "url(" + ObjElem.BACK_IMG + ") center");
            $('.mod-contact').css("background-size", "cover");
            $('.mod-contact').css("opacity", ObjElem.OPACITY);
        }
        else
        {
            if (ObjElem.BACK_COLOR != "")
            {
                $('.mod-contact').css("background", ObjElem.BACK_COLOR);
            }
            else
            {
                if (ObjElem.TRANSPARENT == 'Y')
                    $('.mod-contact').css("background", 'transparent');
                else
                    $('.mod-contact').css("background", '#ffffff');
            }
        }

        $('#PanTitleContact').html(ObjElem.TITLE);
        $('#PanSubTitleContact').html(ObjElem.SUB_TITLE);
    }

    function DisplayFooter(ObjElem, Order)
    {
        var style = "order:" + Order + ";margin-top: 20px;";
        if (ObjElem.OPACITY != "")
        {
            style += "background: " + ObjElem.BACK_COLOR + ";";
            style += "filter: opacity(" + ObjElem.OPACITY + ");";
            style += "-webkit-filter: opacity(" + ObjElem.OPACITY + ");";
        }

        var str = "";
        str += '<section id="SecFooter" style="' + style + '">';
        str += '<div id="PanContainFooter" class="row" style="width: 100%;height:auto;min-height: 100px;margin-left: 0px;">';
        str += '<div id="PanCertifFooter" class="col-lg-4 col-md-4 col-sm-6 col-xs-6 text-center">';
        str += ObjElem.CERTIF;
        str += '</div>';

        str += '<div id="PanMailFooter" class="col-lg-4 col-md-4 col-sm-6 col-xs-6 text-center">';
        str += '<div style="color: #ffffff; font-size:110%;">Email : <span id="SpMail">' + ObjElem.EMAIL + '</span></div>';
        str += '<div style="color: #ffffff; font-size:110%;">Phone : <span id="SpPhone">' + ObjElem.PHONE + '</span></div>';
        str += '</div>';

        str += '<div id="PanLogoFooter" class="col-lg-4 col-md-4 hidden-sm hidden-xs text-center">';

        str += '</div>';

        str += '<div id="PanSocialFooter" class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">';
        if (ObjElem.TWITTER != "")
            str += '<button type="button" class="btn btn-link" event-onclick="OpenSocial("' + ObjElem.TWITTER + '");><img src="/images/img/twitter.png"></button>';

        if (ObjElem.LINKEDIN != "")
            str += '<button type="button" class="btn btn-link" event-onclick="OpenSocial("' + ObjElem.LINKEDIN + '");><img src="/images/img/linkedin.png"></button>';

        if (ObjElem.FACEBOOK != "")
            str += '<button type="button" class="btn btn-link" event-onclick="OpenSocial("' + ObjElem.FACEBOOK + '");><img src="/images/img/facebook.png"></button>';

        if (ObjElem.YOUTUBE != "")
            str += '<button type="button" class="btn btn-link" event-onclick="OpenSocial("' + ObjElem.YOUTUBE + '");><img src="/images/img/youtube2.png"></button>';

        str += '</div>';

        str += '<div id="PanCondSaleFooter" class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">';

        str += '</div>';

        str += '</div>';

        str += '</section>';

        $('.main-homepage').append(str);
    }

    function OpenSocial(url)
    {
        window.open(url, '_blank');
    }
    function HideDivOptTrainee()
	{
	
	}

    $(function() {
        Init();
    });
</script>


<script src="../js/dropzone/dropzone.js"></script>
<link rel="stylesheet" type="text/css" href="../js/dropzone/dropzone.css" />
<link rel="stylesheet" type="text/css" href="../js/dropzone/basic.css" />


<div id="TrainingDetailContentBusiness" data-source="#TrainingDetailContentBusiness" data-start="showTrainingDetail" data-close-target="#mainContentBusiness" style='display:none;'>
    <section id="infos-training">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 8px;text-align: left;'>
                <button class="btn-chevron-close" type='button' data-close="section" >
                    <span class='glyphicon glyphicon-chevron-left' aria-hidden="true"></span>
					<span class="h4 close-header">Back</span>
                </button>
            </div>
        </div>

        <div class="thumb" id="imgtraining">
            <div class="title" id="nametraining"></div>
            <br style="clear: both;" />
        </div>

        <div class="col-sm-8">
            <div class="details-training-descr" style="margin-bottom: 10px;"></div>
            <div  style="margin-bottom: 10px; background: #fafafa;">
                <h4 class="h4-box" style="padding: 6px; margin-bottom: 10px;">Objectives</h4>
                <div class="details-training" style="padding: 6px;"></div>
            </div>
            <ul class="nav nav-tabs" style='margin-top:25px;'>
                <li class="active">
                    <a data-toggle="tab" href="#tab-prog">
                        <span style="font-size:1.3em;" class="glyphicon glyphicon-align-justify" aria-hidden="true"></span> <span class="title-tab">Program</span>
                    </a>
                </li>
                <li>
                    <a data-toggle="tab" href="#tab-public">
                        <span style="font-size:1.3em;" class="glyphicon glyphicon-user" aria-hidden="true"></span> <span class="title-tab">Publics & prerequisites</span>
                    </a>
                </li>
                <li>
                    <a data-toggle="tab" href="#tab-pedago">
                        <span style="font-size:1.3em;" class="glyphicon glyphicon-education" aria-hidden="true"></span> <span class="title-tab">Strong points</span>
                    </a>
                </li>
                <li>
                    <a data-toggle="tab" href="#tab-finance">
                        <span style="font-size:1.3em;" class="glyphicon glyphicon-usd" aria-hidden="true"></span> <span class="title-tab">Finance</span>
                    </a>
                </li>
            </ul>
            <div class="signin-box-content signin-box-border-but-top">
                <div class="tab-content">
                    <div class="tab-pane active" id="tab-prog">
                    </div>
                    <div class="tab-pane" id="tab-public">
                    </div>
                    <div class="tab-pane" id="tab-pedago">
                    </div>
                    <div class="tab-pane" id="tab-finance">
                    </div>
                </div>
            </div>
            <table class="table table-striped table-hover session-table" style="margin-top: 30px;">
                <thead>
                    <tr>
						<th>Language</th>
                        <th>Start date</th>
                        <th>End date</th>
                        <th>Place</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>


            <h4 id='LabTitleTrainingDetailLinked' class='h4-box' style="margin-top: 60px;">These trainings may interest you</h4>
            <div id="trainingDetailLinked" class="signin-box hide" style='margin:0px;padding:0px;'>
                <ul id="LstTrainingLinked" style='padding-left: 0px;'></ul>
            </div>
        </div>
        <div class="col-sm-4">
            <div class="signin-box business">
                <div class="signin-box-content signin-box-border" style='border: none;'>
                    <div class="business-content" style="padding-left: 0px;">
                    </div>
                    <div class="business-comment">
                        <div class="h5-box text-left" style="padding-left: 0px; margin-bottom: 10px;">
                            Evaluation
                        </div>

                        <div class="business-comment2"></div>
                    </div>
                </div>
            </div>
            <div class="signin-box training-org">
                <ul class="nav nav-tabs">
                    <li class="active" id='LiInter'>
                        <a data-toggle="tab" aria-controls="tab-inter" class="text-center" href="#tab-inter" style='font-size: 110%' event-onclick='DisplayInter();'>
                            INTER
                        </a>
                    </li>
                    <li id='LiIntra'>
                        <a data-toggle="tab" aria-controls="tab-intra" class="text-center" href="#tab-intra" style='font-size: 110%' event-onclick='DisplayIntra();'>
                            INTRA
                        </a>
                    </li>
                    <li id='LiTailor'>
                        <a data-toggle="tab" aria-controls="tab-tailor" class="text-center" href="#tab-tailor" style='font-size: 110%' event-onclick='DisplayTailor();'>
                            TAILOR-MADE
                        </a>
                    </li>
                    <li id='LiElearning'>
                        <a data-toggle="tab" aria-controls="tab-elearning" class="text-center" href="#tab-elearning" style='font-size: 110%'>
                            E-learning
                        </a>
                    </li>
                </ul>
                <div class="signin-box-content signin-box-border-but-top" style='height: 210px;'>
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="tab-inter" style='padding-left: 0px; padding-right: 0px; padding-top: 5px;'>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="tab-intra" style='padding-left: 0px; padding-right: 0px; padding-top: 5px;'>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="tab-tailor" style='padding-left: 0px; padding-right: 0px; padding-top: 5px;'>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="tab-elearning" style='padding-left: 0px; padding-right: 0px; padding-top: 5px;'>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="PanTrainingComment" style="display: none">
            <div class="overlayScreen">
                <div class="overlayContent-60">
                    <button type="button" class="close close-overlayScreen" event-onclick="hideTrainingComment();" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <div class="overlay-container">
                        <div class="overlay-title">comment(s)</div>
                        <div class="overlay-content" style="margin: 1em;">
                            <div id="comments-training"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>
</div>



<div id="PanRequestQuote" style='display:none;position: relative; top: 0px; background: #ffffff; '>
	<div class="row" id='PanTitleRequestQuote'>
		<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 8px;text-align: left;'>
			<button class="btn-chevron-close" type='button' data-close="section" event-onclick="CloseRequestQuote();" >
				<span class='glyphicon glyphicon-chevron-left' aria-hidden="true"></span>
			</button>
			<span class="h4 close-header">Request quotation</span>
		</div>
	</div>
	
	<div class="col-sm-8" style='margin-bottom: 30px;'>
		<div id='PanWarningRequest' class='col-sm-12 text-center h5' style='background: #ffffff;margin:20px;color: #f54640;'>
			Your request is being processed
		</div>
		<div id='PanInfoUser' class='col-sm-12 text-center' style='background: #eeeeee;margin-top:20px;'>
			<div class='col-sm-12' style='margin-top:15px;margin-bottom: 15px;'>
				<span class="h5">Your informations</span>
			</div>
			
			<input type='hidden' id='HiTrainingRequestQuote'>
			
			<div class='col-sm-12'>
				<div class="row form-group">
					<input type='text' id='TxtLNameTR' class='form-control' placeholder="Name" required>
				</div>
				<div class="row form-group">
					<input type='text' id='TxtFNameTR' class='form-control' placeholder="First name" required>
				</div>
				<div class="row form-group">
					<input type='text' id='TxtFunctionTR' class='form-control' placeholder="Function" required>
				</div>
				<div class="row form-group">
					<input type='text' id='TxtPhoneTR' class='form-control' placeholder="Phone" required>
				</div>
				<div class="row form-group">
					<input type='email' id='TxtEmailTR' class='form-control' placeholder="Email" required>
				</div>
				<div class="row form-group">
					<input type='text' id='TxtOrgTR' class='form-control' placeholder="Company / Organization" required>
				</div>
				<div class="row form-group">
					<input type='text' id='TxtAddressOrgTR' class='form-control' placeholder="Address of your company / organization" required>
				</div>
				<div class="row form-group">
					<input type='text' id='TxtZipOrgTR' class='form-control' placeholder="Zip of your company / organization" required>
				</div>
				<div class="row form-group">
					<input type='text' id='TxtCityOrgTR' class='form-control' placeholder="City of your company / organization" required>
				</div>
			</div>
		</div>
		
		<div id='PanProject' class='col-sm-12 text-center' style='background: #eeeeee;margin-top: 20px;'>
			<div class='col-sm-12' style='margin-top:15px;margin-bottom: 15px;'>
				<span class="h5-title">Your project</span>
			</div>
			
			<div class='col-sm-12'>
				<div class="row form-group">
					<input type="radio" name='RBIntra' id='RBInter' event-onclick='ChangeOptionTraining();'>&nbsp;<label id='LabIntra' for='RBInter' style='margin-right: 30px;'>INTER</label>
					<input type="radio" name='RBIntra' id='RBIntra' event-onclick='ChangeOptionTraining();'>&nbsp;<label id='LabIntra' for='RBIntra' style='margin-right: 30px;'>INTRA</label>
					<input type="radio" name='RBIntra' id='RBTailored' event-onclick='ChangeOptionTraining();'>&nbsp;<label id='LabTailored' for='RBTailored'>TAILOR-MADE</label>
				</div>
				
				<div class="row form-group text-left">
					<label class="sublabel">Training</label>
					<input type='text' id='TxtTraining' class='form-control' readonly>
				</div>
				
				<div class="row form-group text-left">
					<label class="sublabel">Number of people to train</label>				
					<input type='number' id='TxtNbTrainee' class='form-control' placeholder="Number of people to train" required>
				</div>
				
				<div class="row form-group text-left">
					<label id='LabCityTraining' class="sublabel">City where the training will take place</label>				
					<input type='text' id='TxtCityTraining' class='form-control' placeholder="City where the training will take place">
				</div>
				
				<div class="row form-group text-left">
					<label class="sublabel">Dates or periods desired</label>				
					<input type='text' id='TxtPeriodTraining' class='form-control' placeholder="Dates or periods desired">
				</div>
				<div id='PanSpecification' class="row form-group text-left">
					<label class="sublabel">Specifications</label>
					<div id='PanFileSpecification' class="jumbotron">
					</div>
				</div>
				<div class="row form-group text-left">
					<label class="sublabel">Other informations</label>
					<textarea id='TxtRequestTraining' class='form-control noMceEditor' ></textarea>
				</div>
			</div>
			
			<div id='PanCompTraining' class='col-sm-12' style='background: #fff;'>
				<div class='col-sm-12' style='margin-top:15px;margin-bottom: 15px;'>
					<span class="h5-title">Options</span>
				</div>
				
				<div id='PanOptionTraining' class='col-sm-12 text-left'>
				
				</div>
			</div>
			
			<div class='col-sm-12 text-left' style='margin-top: 10px;'>
				<div class='col-sm-1'>
					<input type='checkbox' id='ChkRGPD' event-onclick='DisableRequestQuote();'>
				</div>
				<div class='col-sm-11'>
					<label for='ChkRGPD' id='LabRGPD'></label>
				</div>
			</div>
			
			<div class='col-sm-12 text-left'>
				<div class='col-sm-1'>
					<input type='checkbox' id='ChkPub'>
				</div>
				<div class='col-sm-11'>
					<label id='LabPub' for='ChkPub'></label>
				</div>
			</div>
			
			<div class='col-sm-12 text-center' style='margin-bottom: 10px;'>
				<button id='ButValidRequestQuote' type='button' class='btn btn-default' event-onclick="ValidRequestQuote();" disabled='true'>Send my request</button>
			</div>
		</div>
		
		<input type='hidden' id='HiOrgIdTR'>
		
	</div>
	
	<div class="col-sm-4 text-center" style='margin-top:20px;'>
		<div class='col-sm-10' style='background: #eeeeee;padding:20px;'>
			<div style='padding-bottom: 20px;'>
				<span class="h5-title">By phone</span>
			</div>
			<div style='background: #ffffff;padding: 10px;'>
				<label id='LabPeriodByPhone'></label>
			</div>
			<div style='background: #ffffff;'>
				<label id='LabPhoneContact' style='font-size: 165%'></label>
			</div>
		
		</div>
	</div>

	<input type='hidden' id='HiReturn'>
</div>



<div id="ContentPlaceHolderBody_ctl00_ctl01_panTemplate">
		

<script nonce="kacyonet" type="text/html-template" id="CommentsTrainingTemplate">
    <div class="panel-comment" data-id="{{ID}}" data-rating-id="{{rating.ID}}">
        {{#author}}
        <div class="comment-left">
            {{#PHOTO}}
            <img src="{{PHOTO}}"></img>
            {{/PHOTO}}
            {{#rating}}
            <div class="training-rating-stars" data-note="{{NOTE}}"></div>
            {{/rating}}
        </div>
        <div class="comment-right">
            <b>{{FNAME}} {{LNAME}}</b>
            {{/author}}
            <small>
                {{#DATE_CREATION}}
                - {{formattedTime}}
                {{/DATE_CREATION}}
            </small>
            <p>
                <b>{{TITRE}}</b>
            </p>
            <div>
                <p>{{{TEXT}}}</p>
            </div>
        </div>
    </div>
</script>
	</div>

<script nonce="kacyonet" type="text/javascript">
    var ratingCommentsSelector = '.training-rating-stars';
	
	var ObjLstFile = [];
	var bdzUpload = false;
	
	function InitDropZone2()
	{
		if (bdzUpload == false)
		{
			$('#PanFileSpecification').empty();
			
			var str = "<div>";
			str += "<div id='dZUploadSpec' class='dropzone needsclick dz-clickable' style='background: #fafafa; border: 1px solid #eeeeee;'>";
			str += "<div class='dz-message needsclick'>Drop files here or click to upload (Max size : 100 Mb)</div>";
			str += "</div>";
			str += "</div>";
			
			$('#PanFileSpecification').append(str);
			
			Dropzone.autoDiscover = false;
			//Simple Dropzonejs 
			
            ObjDomain = domainInfos;

			$("#dZUploadSpec").empty();
				
			$("#dZUploadSpec").dropzone({
				url: "/portal/training/Generics/SaveFile.ashx?p=doc_request_quote",
				addRemoveLinks: true,
				uploadMultiple: false,
				acceptedFiles: "application/pdf",
				maxFiles: 5,
				maxFilesize: 100,
				init: function() {
					this.on('resetFiles', function() {
						this.removeAllFiles();
					});
				},
				success: function (file, response) {
					var imgName = response;
					file.previewElement.classList.add("dz-success");
					
					var ObjFile = new Object();
                    ObjFile.FILE = "/AssetsLibrary/Domains/" + ObjDomain.KEY + "/doc_request_quote/"  + imgName;
					ObjFile.NAME = imgName;
					ObjLstFile.push(ObjFile);
					console.log("Successfully uploaded :" + imgName);
				},
				error: function (file, response) {
					file.previewElement.classList.add("dz-error");
				},
				timeout: 60000
			});
			
			bdzUpload = true;
		}
	}

    function showTrainingDetail(trainingId) {
        jQuery('#TrainingDetailContentBusiness').data('start', 'showTrainingDetail(' + trainingId + ');');

        jQuery('#nametraining').empty();

        jQuery('div.signin-box-content.signin-box-border-but-top').removeClass('hide');
        jQuery('#infos-training div.col-sm-8 ul.nav.nav-tabs').removeClass('hide');
        jQuery('a[href*="#tab-"]').closest('li').removeClass('hide');
        jQuery('#infos-training .details-training-descr').empty();
        jQuery('#infos-training .details-training').empty();
        jQuery('#LstTrainingLinked').empty();
        jQuery('#trainingDetailLinked').addClass('hide');
        $('#LabTitleTrainingDetailLinked').hide();

        ajaxRequest('GET', '/api/TRAINING/' + trainingId + '?ref=ViewTrainingDetail').then(
            function (dTraining) {
                ajaxRequest('GET', '/api/TRAINING/Detail/' + dTraining.TRAINING_ID).then(
                    function (oTraining) {
                        ajaxRequest('GET', '/api/SHEET_TRAINING/' + dTraining.TRAINING_ID + '/' + dTraining.TYPE_TRAINING).then(
                            function (ObjSheet) {
                                jQuery('#nametraining').append(dTraining.NAME);
                                jQuery('#imgtraining')[0].style.backgroundImage = "url('" + dTraining.IMG_URL + "')";

                                if (ObjSheet.CF2) {
                                    jQuery('#infos-training .details-training-descr').empty().append(ObjSheet.CF2);
                                }

                                if (typeof ObjSheet.PEDAGO_GOAL !== 'undefined' && ObjSheet.PEDAGO_GOAL != null && ObjSheet.PEDAGO_GOAL != '')
								{
                                    var $oList = jQuery('<ul/>');
									try {
										var c = $.parseJSON(ObjSheet.PEDAGO_GOAL);
										jQuery.each(JSON.parse(ObjSheet.PEDAGO_GOAL), function (i, obj) {
											$oList.append(jQuery('<li/>').append(obj.TEXT));
										});
									}
									catch (err) {
										$oList.append(jQuery('<li/>').append(ObjSheet.PEDAGO_GOAL));
									}

                                    jQuery('#infos-training .details-training').empty().append($oList);
                                }
								
								// Select Step
								$('#tab-prog').empty();
								ajaxRequest('GET', '/api/TRAINING_STEP/GetStep/' + dTraining.TRAINING_ID).then(
									function (ObjLst) {
										var $DivPan;
										var str = "";
										if (ObjLst.length > 0)
										{
											$DivPan = $('<div class="panel-group" id="AccordProg" style="margin-top: 20px;"></div>');
											$('#tab-prog').append($DivPan);
										}
										else
										{
											jQuery('a[href="#tab-prog"]').closest('li').addClass('hide');
										}
									
										$.each(ObjLst, function (i, ObjStep) {
												str += '<div class="panel panel-default">';
												str += '<div class="panel-heading" style="height: 38px;">';
												str += '<a data-toggle="collapse" data-parent="#Accord_' + i + '" href="#PanProg_' + i + '"  style="font-size: 110%;">';
												str += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-left">';
												str += '<h4 class="panel-title">' + ObjStep["Param1"] + '</h4>';
												str += '</div>';
												str += '</a>';
												str += '</div>';
												str += '<div id="PanProg_' + i + '" class="panel-collapse collapse">';
												if (typeof ObjStep["Param3"] !== 'undefined' && ObjStep["Param3"] != null)
													str += '<div class="panel-body">' + ObjStep["Param3"] + '</div>';
												else
													str += '<div class="panel-body"></div>';
													
												str += '</div>';
												str += '</div>';
											
										});
										$DivPan.append(str);
									
									});
								
								

                                if (ObjSheet.DESCRIPTION) {
                                    jQuery('#tab-finance').empty().append(ObjSheet.DESCRIPTION);
                                }
                                else {
                                    jQuery('a[href="#tab-finance"]').closest('li').addClass('hide');
                                }

                                $('#tab-public').empty();
								var strPub = '';
                                if (ObjSheet.PUBLIC) {
                                    strPub += "<div class='col-lg-6 col-md-6 col-sm-6 col-xs-6 text-center'><div class='h6-box'><span class='glyphicon glyphicon-user'></span> <span>For who</span></div><div>" + ObjSheet.PUBLIC + "</div></div>";
                                }

                                if (ObjSheet.PREREQUISITE) {
                                    strPub += "<div class='col-lg-6 col-md-6 col-sm-6 col-xs-6 text-center'><div class='h6-box'><span class='glyphicon glyphicon-ok'></span> <span>Prerequisites</span></div><div>" + ObjSheet.PREREQUISITE + "</div></div>";
                                }
								if (strPub != '')
								{
									strPub = "<div class='row'>" + strPub + "</div>";
									$('#tab-public').append(strPub);
								}

                                if (!(ObjSheet.PUBLIC || ObjSheet.PREREQUISITE)) {
                                    jQuery('a[href="#tab-public"]').closest('li').addClass('hide');
                                }

                                if (ObjSheet.CF1) {
                                    jQuery('#tab-pedago').empty().append(ObjSheet.CF1);
                                }
                                else {
                                    jQuery('a[href="#tab-pedago"]').closest('li').addClass('hide');
                                }


                                jQuery('#infos-training div.col-sm-8 ul.nav.nav-tabs li').removeClass('active');
                                jQuery('#infos-training div.col-sm-8 div.tab-content .tab-pane').removeClass('active');

                                if (jQuery('#infos-training div.col-sm-8 ul.nav.nav-tabs li:not(.hide)').length > 0) {
                                    var navActive = jQuery('#infos-training div.col-sm-8 ul.nav.nav-tabs li:not(.hide):first');
                                    navActive.addClass('active');
                                    jQuery(navActive.find('a:first').attr('href')).closest('.tab-pane').addClass('active');
                                }
                                else {
                                    jQuery('div.signin-box-content.signin-box-border-but-top').addClass('hide');
                                    jQuery('#infos-training div.col-sm-8 ul.nav.nav-tabs').addClass('hide');
                                }

                                switch (domainInfos.TYPE_DOMAIN.toString()) {
                                    case '1':				// Entreprise
                                        jQuery('.signin-box.business').show();
                                        jQuery('.signin-box.training-org').hide();
                                        jQuery('.business-content').empty();
                                        // RateYo Destroy
                                        jQuery('.jq-ry-container').rateYo("destroy");
                                        jQuery('.business-comment2').empty();

                                        jQuery('.business-content').append('<p>Reference : ' + dTraining.CODE + '</p>');
                                        jQuery('.business-content').append('<p>Duration : ' + oTraining.TRAINING_DURATION + '</p>');
/*
                                        ajaxRequest('GET', '../api/COMMENTS_COMMENT/Global/' + trainingId + '/' + 'CRS').then(function (dRating) {
                                            var rating = jQuery('.business-comment2').append('<div class="rating"></div>');
                                            rating.find('.rating').rateYo({
                                                precision: 1,
                                                readOnly: true,
                                                rating: dRating.Rating
                                            });
                                            jQuery('.business-comment2').append('<p class="link-training-comments" event-onclick="showTrainingComment(' + trainingId + ')"><sub>' + dRating.Comments + ' comment(s)</sub></p>');
                                        });
*/
                                        break;
                                    case '2':				// OF
                                        $('.signin-box.business').show();
                                        $('.signin-box.training-org').show();

                                        jQuery('.signin-box.business').show();
//                                        jQuery('.signin-box.training-org').hide();
                                        jQuery('.business-content').empty();
                                        // RateYo Destroy
                                        jQuery('.jq-ry-container').rateYo("destroy");
                                        jQuery('.business-comment2').empty();

                                        jQuery('.business-content').append('<p>Reference : ' + dTraining.CODE + '</p>');
                                        jQuery('.business-content').append('<p>Duration : ' + oTraining.TRAINING_DURATION + '</p>');

 /*                                       ajaxRequest('GET', '../api/COMMENTS_COMMENT/Global/' + trainingId + '/' + 'CRS').then(function (dRating) {
                                            var rating = jQuery('.business-comment2').append('<div class="rating"></div>');
                                            rating.find('.rating').rateYo({
                                                precision: 1,
                                                readOnly: true,
                                                rating: dRating.Rating
                                            });
                                            jQuery('.business-comment2').append('<p class="link-training-comments" event-onclick="showTrainingComment(' + trainingId + ')"><sub>' + dRating.Comments + ' comment(s)</sub></p>');
                                        });
*/

                                        $('#tab-inter').empty();
                                        $('#tab-intra').empty();
                                        $('#tab-tailor').empty();
                                        $('#tab-elearning').empty();
										
										var ObjCostDetail = null;
										if(typeof ObjSheet.CUSTOM_FIELD_COST !== 'undefined' && ObjSheet.CUSTOM_FIELD_COST != null && ObjSheet.CUSTOM_FIELD_COST != "")
											ObjCostDetail = JSON.parse(ObjSheet.CUSTOM_FIELD_COST);
											
										if (ObjCostDetail != null)
										{
											if (dTraining.TYPE_TRAINING.toString() == '2' || dTraining.TYPE_TRAINING.toString() == '3')
											{
												$('#tab-elearning').hide();
												$('#LiElearning').hide();
												$('.session-table').show();
												
												$('#tab-tailor').show();
												$('#tab-intra').show();
												$('#tab-inter').show();
												$('#LiInter').show();
												$('#LiIntra').show();
												$('#LiTailor').show();
												
											
												if (ObjCostDetail.INTER !== undefined && ObjCostDetail.INTER != null && ObjCostDetail.INTER != 'N') 
												{
													$('#tab-inter').append('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;">Training in our center</div>');
													if (ObjCostDetail.INTER_COMPANY > 0)
													{
														$('#tab-inter').append('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;">Corporate</div>');
														$('#tab-inter').append('<div  class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: left;">Price per trainee</div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: right;font-size:1,5em;color:#7090B0">' + ObjCostDetail.INTER_COMPANY + ' â¬ HT</div>');
														
													}

													if (ObjCostDetail.INTER_PARTICULAR > 0)
													{
														$('#tab-inter').append('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;">Individual</div>');
														$('#tab-inter').append('<div  class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: left;">Price per trainee</div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: right;font-size:1,5em;color:#7090B0">' + ObjCostDetail.INTER_PARTICULAR + ' â¬ HT</div>');
													}

													$('#tab-inter').show();
												}
												else
												{
													$('#tab-inter').hide();
													$('#LiInter').hide();
												}
												
												if (ObjCostDetail.INTRA !== undefined && ObjCostDetail.INTRA != null && ObjCostDetail.INTRA != 'N') 
												{
													$('#tab-intra').append('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;">Training in your company</div>');
													if (ObjCostDetail.INTRA_PRICE > 0)
													{
														$('#tab-intra').append('<div  class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: left;">Price per class</div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: right;font-size:1,5em;color:#7090B0">' + ObjCostDetail.INTRA_PRICE + ' â¬ HT</div>');
														$('#tab-intra').append('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;">Price for a group of ' + ObjCostDetail.INTRA_COND + ' people max</div>');
														$('#tab-intra').append('<div  class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: center;margin-top:10px;"><button type="button" class="btn btn-green-square" event-onclick="ClickRequestQuote(' + trainingId  + ', 1);">Request quotation</button></div>');
													}

													$('#tab-intra').show();
												}
												else
												{
													$('#tab-intra').hide();
													$('#LiIntra').hide();
												}
												
												if (ObjCostDetail.TAILORED !== undefined && ObjCostDetail.TAILORED != null && ObjCostDetail.TAILORED != 'N') 
												{
													$('#tab-tailor').append('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;">Training on demand</div>');
													$('#tab-tailor').append('<div  class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;">' + ObjCostDetail.TAILORED_COND + '</div>');
													$('#tab-tailor').append('<div  class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: center;margin-top:10px;"><button type="button" class="btn btn-green-square" event-onclick="ClickRequestQuote(' + trainingId  + ', 4);">Request quotation</button></div>');

													$('#tab-tailor').show();
												}
												else
												{
													$('#tab-tailor').hide();
													$('#LiTailor').hide();
												}
												
												DisplayInter();
											}
											else
											{
												$('#tab-tailor').hide();
												$('#tab-intra').hide();
												$('#tab-inter').hide();
												$('#LiInter').hide();
												$('#LiIntra').hide();
												$('#LiTailor').hide();
												
												// Cacher la table dessessions
												$('.session-table').hide();
												
												$('#tab-elearning').show();
												$('#LiElearning').show();
												
												if (ObjCostDetail.ELEARNING_COMPANY > 0)
												{
													$('#tab-elearning').append('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;">Corporate</div>');
													$('#tab-elearning').append('<div  class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: left;">Price per trainee</div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: right;font-size:1,5em;color:#7090B0">' + ObjCostDetail.ELEARNING_COMPANY + ' â¬ HT</div>');
												}

												if (ObjCostDetail.ELEARNING_PARTICULAR > 0)
												{
													$('#tab-elearning').append('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;">Individual</div>');
													$('#tab-elearning').append('<div  class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: left;">Price per trainee</div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" style="text-align: right;font-size:1,5em;color:#7090B0">' + ObjCostDetail.ELEARNING_PARTICULAR + ' â¬ HT</div>');
												}
												$('#tab-elearning').append('<div  class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: left;margin-top:10px;">' + ObjCostDetail.ELEARNING_COND + '</div>');
												
												// Attention Ã  la classe en e-learning
												$('#tab-elearning').append('<div  class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: center;margin-top:10px;"><button type="button" class="btn btn-green-square" event-onclick="setTraining(' + dTraining.TRAINING_ID + ', 0);showTrainingReserve();">Subcribe</button></div>');
												
											
											}
										}
                                        break;
                                }


                                ajaxRequest('GET', '/api/CLASSES/TrainingNotClosedAndPassed/' + dTraining.TRAINING_ID).then(
                                    function (ObjTrainingNotClosed) {

                                        jQuery('.session-table tbody').empty();

                                        if (ObjTrainingNotClosed.length > 0) {

                                            jQuery.each(ObjTrainingNotClosed, function (i, session) {
												if (session.DATE_START != null && session.DATE_END != null)
												{
                                                    var classCustomField = JSON.parse(session.CUSTOM_FIELD || '{}');
													jQuery('.session-table tbody').append('<tr>' +
                                                        '<td>' + getFlag(classCustomField.LANG) + '</td>' +
														'<td>' + moment(session.DATE_START).format('LL') + '</td>' +
														'<td>' + moment(session.DATE_END).format('LL') + '</td>' +
														'<td>' + (session.CITY || 'No place filled') + '</td>' +
														'<td>' +
														'<button class="btn btn-green-square" type="button" event-onclick="setTraining(' + session.ELEM_ID + ', ' + session.CLASS_ID + ');showTrainingReserve();">BOOK</button>' +
														'</td>' +
														'</tr>')
												}
                                            });
                                        }
                                        else {
                                            jQuery('.session-table tbody').append('<tr>' +
                                                '<td colspan="5" style="text-align: center;">No session found</td>' +
                                                '</tr>')
                                        }

                                        jQuery('#TrainingDetailContentBusiness').showContent();
                                    }
                                );
                            }
                        );
                    }
                );

                ajaxRequest('GET', '/api/TRAINING_LINKED/GetTrainingLinked/' + dTraining.TRAINING_ID).then(
                    function (linkedTrainings) {
                        if (linkedTrainings.length > 0) {

                            jQuery.each(linkedTrainings, function () {
                                ajaxRequestSync('GET', '../api/TRAINING/Detail/' + this.ELEM_ID).then(function (oLinkedTraining) {
								
									var $Li = $("<li id='LiTrainingLinked_" + oLinkedTraining.TRAINING_ID + "' style='min-height: 35px;margin-bottom: 10px;'></li>");
									var $Div = $("<div class='panel panel-box div-Activity' id='PanTrainingLinked_" + oLinkedTraining.TRAINING_ID + "' event-onclick='showTrainingDetail(" + oLinkedTraining.TRAINING_ID + ");' style='cursor: pointer;border: 1px solid #dddddd;min-height: 35px;height: auto;'></div>");
									var $DivHead = $("<div class='panel-heading row div-Activity' style='margin-left:0px;margin-right:0px;min-height: 35px;height: auto; padding:0px;'></div>");
									var $DivImg = $("<div class='col-lg-2 col-md-2 col-sm-3 col-xs-3' style='padding-left: 0px; padding-right: 0px;'><img src='" + oLinkedTraining.IMG_URL + "' class='img-Activity' style='height:40px;width:auto;'></div>");
									$DivHead.append($DivImg);
									var $DivName = $("<div class='col-lg-8 col-md-8 col-sm-6 col-xs-6' style='text-align:left;padding-left: 0px; padding-right: 0px;margin-top: 2px;'><span class='h5-box' style='border: none;text-transform: none;'>" + oLinkedTraining.NAME + "</span><br/><span>" + oLinkedTraining.DESCR + "</span></div>");
									$DivHead.append($DivName);
									var $DivDuration = $("<div class='col-lg-2 col-md-2 col-sm-3 col-xs-3' style='text-align:right;padding-left: 0px; padding-right: 0px;margin-top:10px;'><span class='glyphicon glyphicon-time' style='font-size: 90%;'></span><span style='font-size: 80%;font-family: verdana, sans-serif;margin-right: 3px;'>&nbsp;" + oLinkedTraining.TRAINING_DURATION + "</span></div>");
									$DivHead.append($DivDuration);
									$Div.append($DivHead);
									$Li.append($Div);
		
									$('#LstTrainingLinked').append($Li);
                                });
                            });

                            jQuery('#trainingDetailLinked').removeClass('hide');
							$('#LabTitleTrainingDetailLinked').show();
							
                        }
                        else {
                            jQuery('#trainingDetailLinked').addClass('hide');
							$('#LabTitleTrainingDetailLinked').hide();
                        }
                    }
                );
            }
        );
		
		$('#TrainingDetailContentBusiness').show();
    }
	
	function CloseTrainingDetail()
	{
		$('#TrainingDetailContentBusiness').hide();
		$('.mod-search').show();
		$('.mod-training').show();
		$('#HomeBusinessPortalControls').show();
	}

    function getFlag(langId) {
        return '<img src="/data/flags/' + domainInfos.LST_LANGUAGE.find(function (l) { return l.LANG_ID == langId }).FLAG + '" style="width: 30px" />'
	}
	
	function DisplayInter()
	{
		$('#tab-tailor').hide();
		$('#tab-intra').hide();
		$('#tab-inter').show();
	}
	
	function DisplayIntra()
	{
		$('#tab-tailor').hide();
		$('#tab-intra').show();
		$('#tab-inter').hide();
	}
	
	function DisplayTailor()
	{
		$('#tab-tailor').show();
		$('#tab-intra').hide();
		$('#tab-inter').hide();
	}
	
	var ObjLstOptionQuote = null;
	
	function ClickRequestQuote(TrainingId, TypeRequest)
	{
		var UserId = "0";
		
		$('#HiReturn').val("1");
		
		if (typeof UserId !== 'undefined' && UserId != null && UserId != "0")
		{
			$('#PanInfoUser').hide();
		}
		else
		{
			$('#PanInfoUser').show();
		}
		
		$('#HiTrainingRequestQuote').val(TrainingId);
		
		$('#PanWarningRequest').hide();
		
		$('#TxtLNameTR').val('');
		$('#TxtFNameTR').val('');
		$('#TxtFunctionTR').val('');
		$('#TxtPhoneTR').val('');
		$('#TxtEmailTR').val('');
		$('#TxtOrgTR').val('');
		$('#TxtAddressOrgTR').val('');
		$('#TxtZipOrgTR').val('');
		$('#TxtCityOrgTR').val('');
		
		$('#PanCompTraining').hide();
		
		$('#PanOptionTraining').empty();
		
		// Select training
		ajaxRequestSync('GET', '/api/TRAINING/' + TrainingId).then(
			function (ObjT) {
				$('#TxtTraining').val(ObjT.NAME);
				
				if (typeof ObjT.DATA !== 'undefined' && ObjT.DATA != null && ObjT.DATA != "")
				{
					ObjLstOptionQuote = JSON.parse(ObjT.DATA);
					
					var NbOption = 0;
					$.each(ObjLstOptionQuote.COMP_TRAINING, function (index, Obj) {
						if (TypeRequest == Obj.TYPE)
						{
							var $Div = $("<div class='col-sm-10'></div>");
							$('#PanOptionTraining').append($Div);
							var $Chk = $("<div class='col-sm-1'><input type='checkbox' id='ChkOption_" + Obj.ID + "'></div><div class='col-sm-11'><label for='ChkOption_" + Obj.ID + "' style='margin-left: 5px;font-weight: 400;'>" + Obj.TEXT + "</label></div>");
							$Div.append($Chk);
							NbOption++;
						}
					});
					
					if (NbOption > 0)
						$('#PanCompTraining').show();
					else
						$('#PanCompTraining').hide();
					
				}
			});
		
		
		// Select user
		if (typeof UserId !== "undefined" && UserId != null && UserId != "")
		{
			ajaxRequestSync('GET', '/api/USERS2/' + UserId).then(
				function (ObjU) {
					$('#TxtLNameTR').val(ObjU.LNAME);
					$('#TxtFNameTR').val(ObjU.FNAME);
					$('#TxtFunctionTR').val(ObjU.CF2);
					$('#TxtPhoneTR').val(ObjU.PHONE);
					$('#TxtEmailTR').val(ObjU.EMAIL);
					
					$('#HiOrgIdTR').val(ObjU.ORG_ID);
					ajaxRequestSync('GET', '/api/ORGS/' + ObjU.ORG_ID).then(
						function (ObjO) {
							$('#TxtOrgTR').val(ObjO.NAME);
							$('#TxtAddressOrgTR').val(ObjO.ADDRESS1);
							$('#TxtZipOrgTR').val(ObjO.ZIP);
							$('#TxtCityOrgTR').val(ObjO.CITY);
						});
				});
		}
		
		
		// Select domain
		ajaxRequestSync('GET', '/api/ShortDomain/1').then(
			function (ObjDomain) {
				var ObjSetting = null;
				
				if (ObjDomain.SETTINGS != null && ObjDomain.SETTINGS != '')
					ObjSetting = JSON.parse(ObjDomain.SETTINGS);
				if (ObjSetting != null)
				{
					$('#LabRGPD').html(ObjSetting.TEXT_RGPD);
					$('#LabPub').html(ObjSetting.TEXT_PUB);
					$('#LabPeriodByPhone').html(ObjSetting.INFO_CONTACT);
					$('#LabPhoneContact').html(ObjDomain.PHONE);
				}
				
			});
		
		

		
		switch (TypeRequest.toString())
		{
			case "1":
				$('#RBIntra').prop('checked', true);
				$('#RBInter').prop('checked', false);
				$('#RBTailored').prop('checked', false);
				$('#PanSpecification').show();
				$('#LabCityTraining').html("City where the training will take place");
				break;
			case "2":
				$('#RBIntra').prop('checked', false);
				$('#RBInter').prop('checked', true);
				$('#RBTailored').prop('checked', false);
				$('#PanSpecification').hide();
				$('#LabCityTraining').html("Desired city");
				break;
			case "4":
				$('#RBIntra').prop('checked', false);
				$('#RBInter').prop('checked', false);
				$('#RBTailored').prop('checked', true);
				$('#PanSpecification').show();
				$('#LabCityTraining').html("City where the training will take place");
				break;
		}
		
		
		$('#TxtNbTrainee').val('');
		$('#TxtCityTraining').val('');
		$('#TxtPeriodTraining').val('');
		$('#TxtRequestTraining').val('');
		$('#ChkRGPD').prop('checked', false);
		$('#ChkPub').prop('checked', false);
		
		InitDropZone2();
	
		$('#PanRequestQuote').show();
		$('.mod-search').hide();
		$('#infos-training').hide();
		$('#TrainingDetailContentBusiness').hide();
		$('#TrainingReserveContentBusiness').hide();
		$('#mainContentBusiness').hide();
		$('#HomeBusinessPortalControls').show();
	}
	
	function DisplayRequestQuote(QuoteId)
	{
//		$("#HiCloseRequestQuote").val();

		$('#HiReturn').val("2");
		
		ajaxRequestSync('GET', '/api/TRAINING_QUOTATION/' + QuoteId).then(
			function (ObjQuote) {
				switch (ObjQuote.STATUS.toString())
				{
					case "1":
						bDisable = false;
						break;
					case "2":
					case "3":
					case "4":
					case "5":
						bDisable = true;
						$('#PanWarningRequest').hide();
						break;
				}
				
				// Select domain
				ajaxRequestSync('GET', '/api/DOMAINs/1').then(
					function (ObjDomain) {
						var ObjSetting = null;
						
						if (ObjDomain.DATA_SETTING != null && ObjDomain.DATA_SETTING != '')
							ObjSetting = JSON.parse(ObjDomain.DATA_SETTING);
							
						if (ObjSetting != null)
						{
							$('#LabRGPD').html(ObjSetting.TEXT_RGPD);
							$('#LabPub').html(ObjSetting.TEXT_PUB);
							$('#LabPeriodByPhone').html(ObjSetting.INFO_CONTACT);
							$('#LabPhoneContact').html(ObjDomain.PHONE);
						}
						
					});
				
				
			
			
				if (typeof ObjQuote.INFO_USER !== 'undefined' && ObjQuote.INFO_USER != null && ObjQuote.INFO_USER != "")
				{
					var ObjInfo = JSON.parse(ObjQuote.INFO_USER);
					$('#TxtLNameTR').val(ObjInfo.LNAME);
					$('#TxtFNameTR').val(ObjInfo.FNAME);
					$('#TxtFunctionTR').val(ObjInfo.FUNCTION);
					$('#TxtPhoneTR').val(ObjInfo.PHONE);
					$('#TxtEmailTR').val(ObjInfo.EMAIL);
					$('#TxtOrgTR').val(ObjInfo.ORG_NAME);
					$('#TxtAddressOrgTR').val(ObjInfo.ORG_ADDRESS);
					$('#TxtZipOrgTR').val(ObjInfo.ORG_ZIP);
					$('#TxtCityOrgTR').val(ObjInfo.ORG_CITY);
					
					if (bDisable == true)
					{
						$('#TxtLNameTR').attr('readonly', 'readonly');
						$('#TxtFNameTR').attr('readonly', 'readonly');
						$('#TxtFunctionTR').attr('readonly', 'readonly');
						$('#TxtPhoneTR').attr('readonly', 'readonly');
						$('#TxtEmailTR').attr('readonly', 'readonly');
						$('#TxtOrgTR').attr('readonly', 'readonly');
						$('#TxtAddressOrgTR').attr('readonly', 'readonly');
						$('#TxtZipOrgTR').attr('readonly', 'readonly');
						$('#TxtCityOrgTR').attr('readonly', 'readonly');
					}
					else
					{
						$('#TxtLNameTR').removeAttr('readonly');
						$('#TxtFNameTR').removeAttr('readonly');
						$('#TxtFunctionTR').removeAttr('readonly');
						$('#TxtPhoneTR').removeAttr('readonly');
						$('#TxtEmailTR').removeAttr('readonly');
						$('#TxtOrgTR').removeAttr('readonly');
						$('#TxtAddressOrgTR').removeAttr('readonly');
						$('#TxtZipOrgTR').removeAttr('readonly');
						$('#TxtCityOrgTR').removeAttr('readonly');
					}
					
					
				}
			
			
				switch (ObjQuote.TYPE_REQUEST.toString())
				{
					case "2":
						$('#RBIntra').prop('checked', false);
						$('#RBInter').prop('checked', true);
						$('#RBTailored').prop('checked', false);
						break;
					case "1":
						$('#RBIntra').prop('checked', true);
						$('#RBInter').prop('checked', false);
						$('#RBTailored').prop('checked', false);
						break;
					case "4":
						$('#RBIntra').prop('checked', false);
						$('#RBInter').prop('checked', false);
						$('#RBTailored').prop('checked', true);
						break;
				}
				
				if (bDisable == true)
				{
					$('#RBIntra').attr('disabled', bDisable);
					$('#RBInter').attr('disabled', bDisable);
					$('#RBTailored').attr('disabled', bDisable);
				}
				else
				{
					$('#RBIntra').removeAttr('disabled');
					$('#RBInter').removeAttr('disabled');
					$('#RBTailored').removeAttr('disabled');
				}
				
				
				var ObjLstOptionQuote = null;
				ajaxRequestSync('GET', '/api/TRAINING/' + ObjQuote.TRAINING_ID).then(
					function (ObjT) {
						$('#TxtTraining').val(ObjT.NAME);
						
						if (typeof ObjT.DATA !== 'undefined' && ObjT.DATA != null && ObjT.DATA != "")
						{
							ObjLstOptionQuote = JSON.parse(ObjT.DATA);
						}
					});
				
						
				$('#TxtNbTrainee').val(ObjQuote.NB_TRAINEE);
				$('#TxtCityTraining').val(ObjQuote.CITY_CLASS);
				$('#TxtPeriodTraining').val(ObjQuote.PERIOD_CLASS);
				if (typeof ObjQuote.REQUEST !== 'undefined' && ObjQuote.REQUEST != null)
					$('#TxtRequestTraining').val(ObjQuote.REQUEST);
					
				if (bDisable == true)
				{
					$('#TxtNbTrainee').attr('readonly', 'readonly');
					$('#TxtCityTraining').attr('readonly', 'readonly');
					$('#TxtPeriodTraining').attr('readonly', 'readonly');
					$('#TxtRequestTraining').attr('readonly', 'readonly');
				}
				else
				{
					$('#TxtNbTrainee').removeAttr('readonly');
					$('#TxtCityTraining').removeAttr('readonly');
					$('#TxtPeriodTraining').removeAttr('readonly');
					$('#TxtRequestTraining').removeAttr('readonly');
				}
				

				if (ObjLstOptionQuote != null)
				{
					$('#PanOptionTraining').empty();
					$.each(ObjLstOptionQuote.COMP_TRAINING, function (index, Obj) {
						if (ObjQuote.TYPE_REQUEST == Obj.TYPE)
						{
							var $Div = $("<div class='col-sm-10'></div>");
							$('#PanOptionTraining').append($Div);
							
							var strDisable = "";
							if (bDisable == true)
							{
								strDisable = "disabled";
							}
							var $Chk = $("<input type='checkbox' id='ChkOption_" + Obj.ID + "' " + strDisable + "><label for='ChkOption_" + Obj.ID + "' style='margin-left: 5px;font-weight: 400;'>" + Obj.TEXT + "</label>");
							$Div.append($Chk);
						}
					});
				
					$('#PanCompTraining').show();
				
					if (typeof ObjQuote.OPTION_TRAINING !== 'undefined' && ObjQuote.OPTION_TRAINING != null && ObjQuote.OPTION_TRAINING != "")
					{
						var ObjLstOption = JSON.parse(ObjQuote.OPTION_TRAINING);
						$.each(ObjLstOption, function (index, Obj2) {
							$('#ChkOption_' + Obj2.ID).prop('checked', true);
						});
					}
				}			
					
			
			});
		$('.mod-search').hide();
		$('#PanRequestQuote').show();
	}
	
	function ChangeOptionTraining()
	{
		$('#PanOptionTraining').empty();
		
		var TypeRequest = "";
		if ($('#RBInter').prop('checked')== true)
			TypeRequest = "2";
		if ($('#RBIntra').prop('checked')== true)
			TypeRequest = "1";
		if ($('#RBTailored').prop('checked')== true)
			TypeRequest = "4";
		
		// Select training
		ajaxRequestSync('GET', '/api/TRAINING/' + $('#HiTrainingRequestQuote').val()).then(
			function (ObjT) {
				$('#TxtTraining').val(ObjT.NAME);
				
				if (typeof ObjT.DATA !== 'undefined' && ObjT.DATA != null && ObjT.DATA != "")
				{
					ObjLstOptionQuote = JSON.parse(ObjT.DATA);
					
					$.each(ObjLstOptionQuote.COMP_TRAINING, function (index, Obj) {
						if (TypeRequest == Obj.TYPE)
						{
							var $Div = $("<div class='col-sm-10'></div>");
							$('#PanOptionTraining').append($Div);
							var $Chk = $("<input type='checkbox' id='ChkOption_" + Obj.ID + "'><label for='ChkOption_" + Obj.ID + "' style='margin-left: 5px;font-weight: 400;'>" + Obj.TEXT + "</label>");
							$Div.append($Chk);
						}
					});
					
				
					$('#PanCompTraining').show();
				}
			});	
	}
	
	function DisableRequestQuote()
	{
		if ($('#ChkRGPD').prop("checked") == true)
			$('#ButValidRequestQuote').prop("disabled", false);
		else
			$('#ButValidRequestQuote').prop("disabled", true);
		
	}
	
	function ValidRequestQuote()
	{
		var ObjQuote = new Object();
		
		ObjQuote.DOMAIN_ID = "1";
		ObjQuote.USER_ID = "0";
		ObjQuote.ORG_ID = $('#HiOrgIdTR').val();
		ObjQuote.TRAINING_ID = $('#HiTrainingRequestQuote').val();
		
		var ObjInfoUser = new Object();
		ObjInfoUser.LNAME = $('#TxtLNameTR').val();
		ObjInfoUser.FNAME = $('#TxtFNameTR').val();
		ObjInfoUser.FUNCTION = $('#TxtFunctionTR').val();
		ObjInfoUser.PHONE = $('#TxtPhoneTR').val();
		ObjInfoUser.EMAIL = $('#TxtEmailTR').val();
		ObjInfoUser.ORG_NAME = $('#TxtOrgTR').val();
		ObjInfoUser.ORG_ADDRESS = $('#TxtAddressOrgTR').val();
		ObjInfoUser.ORG_ZIP = $('#TxtZipOrgTR').val();
		ObjInfoUser.ORG_CITY = $('#TxtCityOrgTR').val();
		
		ObjQuote.INFO_USER = JSON.stringify(ObjInfoUser);
		
		if ($('#RBIntra').prop('checked') == true)
			ObjQuote.TYPE_REQUEST = "1";
		if ($('#RBInter').prop('checked') == true)
			ObjQuote.TYPE_REQUEST = "2";
		if ($('#RBTailored').prop('checked') == true)
			ObjQuote.TYPE_REQUEST = "4";
		
		ObjQuote.NB_TRAINEE = $('#TxtNbTrainee').val();
		ObjQuote.CITY_CLASS = $('#TxtCityTraining').val();
		ObjQuote.PERIOD_CLASS = $('#TxtPeriodTraining').val();
		ObjQuote.REQUEST = $('#TxtRequestTraining').val();
		ObjQuote.STATUS = "1";
		ObjQuote.DATE_REQUEST = new Date();
		
		if (typeof ObjLstFile !== 'undefined' && ObjLstFile != null && ObjLstFile != "")
			ObjQuote.SPECIFICATION = JSON.stringify(ObjLstFile);
		
		var ObjFollow = new Object();
		ObjFollow.DATE = new Date();
		ObjFollow.STATUS_INIT = "1";
		ObjFollow.STATUS_AFTER = "";
		ObjFollow.USER_ID = ObjQuote.USER_ID;
		
		var ObjLstFollow = [];
		ObjLstFollow.push(ObjFollow);
		ObjQuote.FOLLOW = JSON.stringify(ObjLstFollow);
		

		if (typeof ObjLstOptionQuote !== 'undefined' && ObjLstOptionQuote != null)
		{
			var ObjLstOptionSelect = [];
			$.each(ObjLstOptionQuote.COMP_TRAINING, function (index, Obj) {
				
				if ($('#ChkOption_' + Obj.ID).prop('checked') == true)
				{
					ObjLstOptionSelect.push(Obj);
				}
			});
			
			ObjQuote.OPTION_TRAINING = JSON.stringify(ObjLstOptionSelect);
		}
		
		
		if ($('#ChkRGPD').prop('checked') == true)
			ObjQuote.RGPD = true;
		else
			ObjQuote.RGPD = false;
		
		if ($('#ChkPub').prop('checked') == true)
			ObjQuote.PUB = true;
		else
			ObjQuote.PUB = false;
			
		ajaxRequestSync('POST', '/api/TRAINING_QUOTATION', ObjQuote).then(
			function (ObjQ) {
			
			});
	
		alert('Your request is taken into account. You will quickly receive a quote');
		
		CloseRequestQuote();
	}
	
	function CloseRequestQuote()
	{
		switch ($('#HiReturn').val())
		{
			case "1":
				$('#PanRequestQuote').hide();
				$('.mod-search').show();
				$('#TrainingDetailContentBusiness').show();
				$('#infos-training').show();
				break;
			case "2":
				$('#PanRequestQuote').hide();
				DisplayLstQuote($('#LstSortQuotation').val());
				break;
		}
	}
	
	

    function showTrainingComment(trainingId) {
        ajaxRequest('GET', '/api/COMMENTS_COMMENT/From?LINK_TYPE=CRS&LINK_ID=' + trainingId).then(function (oClass) {
            var CommentsTemplate = jQuery('#CommentsTrainingTemplate').html();
            jQuery('#comments-training').empty();

            if (oClass.length > 0) {
                // Comments
                jQuery.each(oClass, function () {
                    this.formattedTime = moment(this.DATE_CREATION).format('LL');
                    jQuery('#comments-training').append(Mustache.to_html(CommentsTemplate, this));
                });

                // RateYo init for comments
                jQuery(ratingCommentsSelector).each(function () {
                    jQuery(this).rateYo({
                        starWidth: '10px',
                        rating: jQuery(this).data('note'),
                        readOnly: true
                    });
                });

                jQuery('#PanTrainingComment').show();
            }
        });
    };

    function hideTrainingComment() {
        jQuery('#PanTrainingComment').hide();
        jQuery(ratingCommentsSelector).rateYo("destroy");
    }
</script>
<link rel="stylesheet" type="text/css" href="/js/jquery-ui/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="/js/bootstrapSwitch/css/bootstrap-switch.css" media="screen">
<script type="text/javascript" src="/js/bootstrap-filestyle/bootstrap-filestyle.min.js"></script>
<script src="/js/bootstrapSwitch/js/bootstrap-switch.js"></script>

<style>
    .ui-autocomplete-loading {
        background: white url("../images/loading_2.gif") right center no-repeat;
    }
    .ui-autocomplete {
        min-width:400px;
        max-height:250px;
        overflow-y: auto;
        overflow-x: hidden;
        z-index:999999999999999999999999;
    }
</style>

<div id="TrainingReserveContentBusiness" data-source="#TrainingReserveContentBusiness" data-start="setTraining" data-close-target="showTrainingDetail(jQuery('#HiTrainingReserveId').val());">
<!-- Reservation Formation -->
    <section id="reserve-training">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 8px;text-align: left;'>
                <button class="btn-chevron-close" type='button' data-close="section">
                    <span class='glyphicon glyphicon-chevron-left' aria-hidden="true"></span>
                    <span class="h4 close-header">Back</span>
                </button>
            </div>
        </div>
        <div class="thumb">
            <div class="title">
            </div>
        </div>
        <div class="form-progress" data-actual-step="1">
            <div class="form-steps">
                <div class="steps-progress">
                    <div class="step-progress-line"></div>
                </div>
                <div class="form-step-25 active" data-step-target="1" event-onclick="setActiveStep(1);">
                    <div class="form-step-icon">
                        <i class="fa fa-graduation-cap"></i>
                    </div>
                    <p>Training</p>
                </div>
                <div class="form-step-25" data-step-target="2">
                    <div class="form-step-icon">
                        <i class="fa fa-building"></i>
                    </div>
                    <p>Login</p>
                </div>
                <div class="form-step-25" data-step-target="3">
                    <div class="form-step-icon">
                        <i class="fa fa-users"></i>
                    </div>
                    <p>Collaborators</p>
                </div>
                <div class="form-step-25" data-step-target="4">
                    <div class="form-step-icon">
                        <i class="fa fa-thumbs-up"></i>
                    </div>
                    <p>Summary</p>
                </div>
            </div>
        </div>
        <div class="progress-content">
            <div class="step-content" data-step-target="1">
                <div class="content">
                    <div class="row">
                        <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1 col-md-offset-1 col-sm-offset-1 col-xs-offset-1" style="margin-top: 8px;text-align: left;">
                            <div class="row login-panel" style="margin-top: 8px;text-align: left;">
                                <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1" style="margin-top: 16px;text-align: left;">
                                    <div class="content-step-descr">
                                    </div>
                                </div>
                                <div class="text-center">
                                    <button  style="margin: 16px;" class="btn btn-green-square" type="button" event-onclick="setActiveStep(2);">Continue</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="step-content" data-step-target="2">
                <div class="content">
                    <div class="row">
                        <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1 col-md-offset-1 col-sm-offset-1 col-xs-offset-1" style='margin-top: 8px;text-align: left;'>
                            <div style='margin-top: 8px;text-align: left;margin-bottom:15px;'>
                                <span class="h4-box">Already member:</span>
                            </div>
                            <div class="row login-panel">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 8px;text-align: left;'>
                                    <div class="col-lg-5 col-md-5 col-sm-6 col-xs-6" style='margin-top: 8px;text-align: right;'>
                                        <label for="TxtLoginMail" style='font-weight: 200;'>My login</label>
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-6" style='margin-top: 8px;text-align: left;'>
                                        <input type="text" class="form-control" id="TxtLoginMail" maxlength="200">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='text-align: left;'>
                                    <div class="col-lg-5 col-md-5 col-sm-6 col-xs-6" style='margin-top: 8px;text-align: right;'>
                                        <label for="TxtLoginPassword" style='font-weight: 200;'>My password</label>
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-6" style='margin-top: 8px;text-align: left;'>
                                        <input type="password" class="form-control" id="TxtLoginPassword" maxlength="200">
                                    </div>
                                </div>
                                <button id="BtnValidLogin" type="button" class="btn btn-green-square" style="margin: 16px;" event-onclick="LoginReserveTraining();">Login</button>
                                <div style="margin-bottom: 15px;">
                                    <span style="cursor: pointer;" event-onclick="jQuery('#modalForgottenPassword').data('only',1).modal('show');">Forgot password</span>
                                </div>
                                <div id="MsgLogin" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="color:red;font-family:Verdana;font-size:10pt; margin-bottom:15px; display:none"></div>
                            </div>
                            <div style='margin-top: 8px;text-align: left;margin-bottom:15px;'>
                                <span class="h4-box">1<sup>st</sup> visit: account creation</span>
                            </div>
                            <div class="row login-panel">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 8px;text-align: left;'>
                                    <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1" style='margin-top: 8px;text-align: left;'>
                                        <label style='font-weight: 200;'>With my account, I will be able to:</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1" style='padding-left: 40px;text-align: left;'>
                                        <label style='font-weight: 200;'>- Enroll myself or my collaborators to training sessions</label><br />
                                        <label style='font-weight: 200;'>- Access to my ongoing trainings</label><br />
                                        <label style='font-weight: 200;'>- See my training history</label><br />
                                    </div>
                                </div>
                                <button type="button" class="btn btn-green-square" style="margin: 16px;" event-onclick="CreateAccountReserveTraining();">Create my account</button>
                                <div id="pan-new-account" style="display:none">
                                </div>
                                <div id="ButValidCreateaccount" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 8px;display:none;'>
                                    <button type="button" class="btn btn-green-square" style="margin: 16px;cursor:default" event-onclick="ValidCreateAccountReserveTraining();">Validate</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="step-content" data-step-target="3">
                <div class="content">
                    <div>
                        <div class="row">
                            <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1 col-md-offset-1 col-sm-offset-1 col-xs-offset-1" style='margin-top: 8px;text-align: left;'>
                                <div class="row login-panel" style="margin-top: 8px;">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 8px;margin-bottom: 8px;text-align: left;display:none;'>
                                        <label>Available seats :&nbsp;</label><label id="LabNbPlacesAvailable"></label>
                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 16px;'>
                                        <div style="display:table; width: 100%">
                                            <div style="display:table-cell; width:47%; text-align: right">
                                                <button type="button" id="BtnEnrollMyself" class="btn btn-green-square" event-onclick="enrollMyself();">Enroll myself</button>
                                            </div>
                                            <div style="display:table-cell; text-align: center">
                                                or
                                            </div>
                                            <div style="display:table-cell; width:47%; text-align: left">
                                                <button type="button" class="btn btn-green-square" event-onclick="showPanTrainee();">Enroll collaborator</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="PanTableTrainee" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top:16px;text-align: left;">
                                        <table class="table table-striped table-hover trainee-table">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>First name</th>
                                                    <th>Entity</th>
                                                    <th>Date - Place</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="BodyTraineeTable">
                                                <tr id="Row_initial">
                                                    <td colspan="5" style="text-align: center;">No trainee added</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div id="PanTotalPrice" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 8px;margin-bottom: 8px;text-align: right;'>
                                        <div class="col-lg-2 col-md-2 col-sm-3 col-xs-6 col-lg-offset-8 col-md-offset-8 col-sm-offset-3" style='margin-top: 8px;margin-bottom: 8px;text-align: center;'>
                                        <label>Total price excl tax :</label>
                                        </div>
                                        <div class="col-lg-2 col-md-2 col-sm-3 col-xs-6" style='margin-top: 8px;margin-bottom: 8px;text-align: right;'>
                                            <label id="TotalPrice"></label>&nbsp;&nbsp;<label id="Currency"></label>
                                        </div>
                                    </div>
                                    <div class="text-center" style="margin-bottom:16px;">
                                        <button type="button" style="display:none;" class="btn btn-default" event-onclick="setActiveStep(2);">Back</button>
                                        <button type="button" id="BtnValidPreEnroll" class="btn btn-default" event-onclick="setActiveStep(4);" disabled="disabled">Valid</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="PanAddTrainee" style="display: none">
                    <div class="overlayScreen">
                        <div class="overlayContent-60" style="max-width: 1200px; width: calc(100vw - 50px);">
                            <button type="button" class="close close-overlayScreen" event-onclick="hidePanAddTrainee();" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <div class="overlay-container">
                                <div id="AddTraineeTitle" class="overlay-title">Add collaborator(s)</div>
                                <div class="overlay-content" style="margin: 1em;">
                                    <div id="MsgSuccess" class="alert alert-success text-center" style="width: 100%; display: none;" role="alert">
                                        <strong>Collaborators successfully added</strong>
                                    </div>
                                    <div id="pan-new-preenroll">
                                        
                                    </div>
                                    <div id="LstClassAvailable" class="form-group col-lg-6 col-md-6 col-sm-12 col-xs-12" style="display: none">
                                        <label for="LstClassEnroll">Dates</label>
                                        <select class="form-control" id ="LstClassEnroll"></select>
                                    </div>
                                    <div class="text-center" style="clear: both">
                                        <button type="button" class="btn btn-default" event-onclick="hidePanAddTrainee();">Cancel</button>
                                        <button id="ButValidPreEnroll" type="button" class="btn btn-green-square" event-onclick="ShowPanTraineeSummary()">Confirm your requirements</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="PanTraineeError" style="display: none">
                    <div class="overlayScreen">
                        <div class="overlayContent-60">
                            <button type="button" class="close close-overlayScreen" event-onclick="jQuery('#PanTraineeError').hide();" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <div class="overlay-container">
                                <div id="ErrorTraineeTitle" class="overlay-title">Warning</div>
                                <div class="overlay-content" style="margin: 1em;">
                                    <div class="row">
                                        <div id="MsgTraineeError" class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        </div>
                                    </div>
                                    <div class="text-center" style="clear: both; margin-top: 20px;">
                                        <button type="button" class="btn btn-default" event-onclick="jQuery('#PanTraineeError').hide();">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="PanTraineeSummary" style="display: none">
                    <div class="overlayScreen">
                        <div class="overlayContent-60" style="max-width: 1200px; width: calc(100vw - 50px); max-width: 600px">
                            <button type="button" class="close close-overlayScreen" event-onclick="jQuery('#PanTraineeSummary').hide()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <div class="overlay-container">
                                <div class="overlay-title">Enrollment summary</div>
                                <div class="overlay-content" style="margin: 1em;">
                                    <div id="pan-preenroll-infos" class="row">
                                        
                                    </div>
                                    <div class="text-center" style="clear: both">
                                        <button type="button" class="btn btn-default" event-onclick="jQuery('#PanTraineeSummary').hide()">Back</button>
                                        <button id="ButValidPreEnroll2" type="button" class="btn btn-green-square" event-onclick="enrollTrainee();">Valid</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="step-content" data-step-target="4">
                <div class="content">
                    <div class="row">
                        <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1 col-md-offset-1 col-sm-offset-1 col-xs-offset-1" style="margin-top: 8px;text-align: left;">
                            <div class="row login-panel" style="margin-top: 8px;text-align: left;">
                                <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1" style="margin-top: 16px;text-align: left;">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style='margin-top: 8px;text-align: center;margin-bottom: 16px;'>
                                        <span class="h4-box" style="text-transform: initial">Your pre-registration has been successfully sent to these collaborators:</span>
                                    </div>
                                    <div class="content-step-success">
                                    </div>
                                </div>
                                <div class="text-center">
                                    <button type="button" style="margin: 16px;" class="btn btn-green-square" event-onclick="CloseReserveTraining();">Finish</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <input type="hidden" id="HiTrainingReserveId" />
        <input type="hidden" id="HiClassReserveId" />
    </section>
</div>

<script nonce="kacyonet" type="text/javascript">
    var NbPlaceAvailable;
    var LstTrainees = [];
    var MyUserId = 0;
    var LoggedUserId = 0;
    var LoggedUserOrg;
    var LoggedUserCF10;

    $(document).ready(function(){
        $('#TxtLoginPassword').keypress(function (e) {
            if (e.keyCode == 13) {
                $('#BtnValidLogin').click();
            }
        });
    });

    function setTraining(tid, cid) {
        jQuery('#HiTrainingReserveId').val(tid);
        jQuery('#HiClassReserveId').val(cid);
    }

    function CreateAccountReserveTraining() {
        ViewForm('FORM_CREATE_ACCOUNT', '#pan-new-account');
        jQuery('#pan-new-account').show();
    }

    function LoginReserveTraining() {
        var obj = new Object();
        obj.Login = jQuery('#TxtLoginMail').val();
        obj.Password = jQuery('#TxtLoginPassword').val() || jQuery('#TxtLoginMail').val();
        obj.Target = "Portal";

        jQuery('#MsgLogin').hide();
        setTimeout(function () {
            ajaxRequestSync('POST', '/api/USERS/LOGON', obj).then(function (answer) {
                if (answer.Status == 200) {
                    if (answer.Response.userName !== 'Empty') {
                        sessionStorage.setItem(tokenKey, answer.Response.access_token);
                        ajaxRequest('GET', '/api/USERS2/' + answer.Response.userId).then(
                            function (answerUser) {
                                LoggedUserOrg = answerUser.ORG_ID;
                                LoggedUserCF10 = answerUser.CF10;
                            });

                        LoggedUserId = answer.Response.userId;
                        $('#ButValidCreateaccount button').prop('disabled', false);
                        validMenu()
                        setActiveStep(3);
                    }
                }
                else if (answer.Status === 403 || answer.Status === 404) {
                    jQuery('#MsgLogin').show().html(answer.Error.Message);
                }
            });
        }, 100);
    }

    function ValidCreateAccountReserveTraining() {
        if (ValidForm('FORM_CREATE_ACCOUNT', '#pan-new-account')) {
            $('#ButValidCreateaccount button').prop('disabled', true);
            ValidCreateAccount(false, true);
        }
    }

    function ValidCreateAccount(send, login) {
        var user = {};
        $('[data-field*="-USERS2-"]:not([data-cf-specific]):visible').each(function (index, element) {
            var field = $(element).data('field').split('-')[2];
            user[field] = $(element).find('select, input').val();
        });
        user.LG_INTER = 2;
        user.DOMAIN_ID = 1;
        user.PHOTO = createPersonIcone.bind($("<img />"))((user.FNAME[0] || '') + (user.LNAME[0] || ''));
        user.DTPASSWORD = new Date();
        user.CF10 = user.CF10 || LoggedUserCF10;
        if (!user.ORG_ID) {
            if (LoggedUserId) {
                ajaxRequestSync('GET', '/api/USERS2/' + LoggedUserId).then(function (answerUser) {
                    user.ORG_ID = answerUser["ORG_ID"];
                }, HandlerError);
            }
            else {
                if ($('#ButValidCreateaccount').data('ORG_ID'))
                    user.ORG_ID = parseInt($('#ButValidCreateaccount').data('ORG_ID'), 10);
                else {
                    switch ($('[for^=CHK_USER_CATEGORIES_].active').attr('for').split('_')[3]) {
                        case '0':
                            user.ORG_ID = 745
                            break;
                        case '1':
                            user.ORG_ID = 748
                            break;
                        case '2':
                            user.ORG_ID = 749
                            break;
                    }
                }
            }
        }

        return ajaxRequestSync('POST', '/api/USERS2', user).then(function (User) {
            ajaxRequestSync('GET', '/api/PROFILE/location/2').then(function (Profile) {
                return Profile[0].PROFILE_ID;
            }).then(function (profileId) {
                ajaxRequestSync('POST', '/api/USER_PROFILE', { USER_ID: User.USER_ID, PROFILE_ID: profileId }).then(function (Obj) {
                    if (send)
                        ajaxRequestSync('GET', '/api/USERS/SEND_MAIL_ACCOUNT_CREATE/' + profileId + '/' + User.USER_ID);
                    jQuery('#TxtLoginMail').val($('[data-field$="-USERS2-EMAIL"]:visible input').val());
                    jQuery('#TxtLoginPassword').val($('[data-field$="-USERS2-PASSWORD"]:visible input').val());
                    if (login)
                        LoginReserveTraining();
                });
            });
            return User.USER_ID;
        }, HandlerError);
    }

    function enrollMyself() {
        ajaxRequest('GET', '/api/USERS2/' + LoggedUserId).then(function (answerUser) {
            ajaxRequest('GET', '/api/ORGS/' + answerUser.ORG_ID).then(function (answerorg) {
                jQuery('#ButValidPreEnroll').attr('data-myself', true);
                $('#pan-new-preenroll').after($('#LstClassAvailable').hide());
                ViewForm('FORM_PREENROLL_CLASS', '#pan-new-preenroll', { me: true });

                jQuery('#LstClassEnroll').val(jQuery('#HiClassReserveId').val());
                ajaxRequest('GET', '/api/CLASSES/Model/' + $("#LstClassEnroll option:selected").val()).then(function (oClass) {
                    ajaxRequest('GET', '/api/CLASS_STEP/LIST_STEP/' + $("#LstClassEnroll option:selected").val()).then(function (aClassSteps) {
                        InitViewForm(answerUser, answerorg, oClass, aClassSteps)

                        jQuery('#AddTraineeTitle').text(`Enroll myself`)
                        jQuery('#PanAddTrainee').show();
                    })
                })
            }, HandlerError);
        }, HandlerError);
    }

    function enrollTrainee() {
        $("#ButValidPreEnroll").css("cursor", "progress");
        setTimeout(function () {
            var lname = "", fname = "", org = "", orgId = 0;

            function getInfo(userId) {
                ajaxRequestSync('GET', '/api/USERS/GET_SHORT_BY/USER_ID/' + userId).then(function (answerUser) {
                    lname = answerUser[0]["LNAME"];
                    fname = answerUser[0]["FNAME"];
                    orgId = answerUser[0]["ORG_ID"];
                    org = answerUser[0]["ORG_NAME"];                    
                }, HandlerError);
            }

            var formuleIsValid = ValidFormule()
            var transportIsValid = ValidTransport()
            if (jQuery('#ButValidPreEnroll').attr('data-myself')) {
                if (ValidForm('FORM_PREENROLL_CLASS', '#pan-new-preenroll') && formuleIsValid && transportIsValid) {
                    MyUserId = LoggedUserId;
                    getInfo(MyUserId);
                }
                else {
                    $("#ButValidPreEnroll").css("cursor", "");
                    return;
                }
            }
            else {
                if (ValidForm('FORM_PREENROLL_CLASS', '#pan-new-preenroll') && formuleIsValid && transportIsValid) {
                    if (jQuery('#ButValidPreEnroll').attr('data-found') === "true") {
                        MyUserId = parseInt(jQuery('#ButValidPreEnroll').attr('data-value'));
                        getInfo(MyUserId);
                    }
                    else {
                        ValidCreateAccount(true, false).then(
                            function (userId) {
                                MyUserId = userId || 0;
                            }
                        );
                        getInfo(MyUserId);
                    }
                }
                else {
                    $("#ButValidPreEnroll").css("cursor", "");
                    return;
                }
            }
            LstTrainees = LstTrainees.filter(function (obj) { return parseInt(obj.ID) !== parseInt(MyUserId) } );

            $('#Row_' + MyUserId).remove();

            var Trainee = {}
            Trainee['ID'] = MyUserId;
            Trainee['CLASS_ID'] = $("#LstClassEnroll option:selected").val();
            Trainee['TRAINING_ID'] = jQuery('#HiTrainingReserveId').val();
            Trainee['ORG_ID'] = orgId;

            ajaxRequestSync('GET', '/api/CLASSES/Model/' + $("#LstClassEnroll option:selected").val()).then(function (oClass) {
                var ObjPrice = JSON.parse(oClass.CF5);
                var price = (parseFloat($("#TotalPrice").html()) || 0) + (parseFloat(ObjPrice && ObjPrice.PRICE1 || 0) || 0);
                $("#TotalPrice").html(price);
                Trainee['PRICE'] = parseFloat(ObjPrice && ObjPrice.PRICE1 || 0) || 0;
            });
            Trainee['OPTIONS'] = JSON.stringify(GetOptionsEnroll());

            LstTrainees.push(Trainee);

            jQuery('.trainee-table tbody').append('<tr id="Row_' + MyUserId + '">' +
                '<td>' + lname + '</td>' +
                '<td>' + fname + '</td>' +
                '<td>' + org + '</td>' +
                '<td>' + $("#LstClassEnroll option:selected").text() + '</td>' +
                '<td class="OptUnenroll">' +
                '<img src="/images/del.png" event-onclick="unEnrollTrainee(' + MyUserId + ');" style="height: 15px;cursor:pointer">' +
                '</td>' +
                '</tr>');

            var inputFile = document.querySelector('#panVisa input[type=file]').cloneNode()
            inputFile.id = 'visa_' + MyUserId
            inputFile.onchange = null
            jQuery('.trainee-table tbody #Row_' + MyUserId + ' .OptUnenroll').append(inputFile)


            $('#Row_initial').remove();

            $('#AddTraineeTitle').parent().parent().animate({ scrollTop: 0 }, 'fast');

            if (jQuery('#ButValidPreEnroll').attr('data-myself')) {
                $("#BtnEnrollMyself").prop("disabled",true);
                hidePanAddTrainee();
            }
            else {
                ResetFormGeneric('#pan-new-preenroll');
                if (typeof (EnrollTraineeClient) !== 'undefined')
                    EnrollTraineeClient();

                if ($("#PanAddTrainee").is(":visible")) {
                    $('#MsgSuccess').fadeIn();
                    setTimeout(function () {
                        $('#MsgSuccess').fadeOut("slow");
                    }, 10000);
                }
            }
            $("#ButValidPreEnroll").css("cursor", "");
            $("#BtnValidPreEnroll").prop("disabled", false).addClass('btn-green-square');
            $('#PanTraineeSummary').hide();
        }, 100);
    }

    function ValidFormule() {
        var isValid = true
        var form = $('#pan-new-preenroll .formules')
        if (form.length == 0) return isValid;

        var formule = form.find('[name="formules"]:checked').val()
        if (!formule) {
            form.find('[name="formules"]').closest('div').css('border', '1px solid red')
            isValid = false
        }

        return isValid;
    }

    function ValidTransport() {
        var isValid = true
        var form = $('#panTransport')

        $('input:radio, label', form).css('color', '')
        $('input[type=text], input[type=date]', form).css('border', '')
        $('select:visible', form).css('border', '')

        $('input:radio:visible', form).each(function () {
            var name = $(this).attr('name')
            if (!$(`input:radio:visible[name=${name}]:checked`, form).length) {
                $(this).parent().css('color', 'red')
                isValid = false
            }
        })
        $('input[type=text]:visible, input[type=date]:visible, input[type=time]:visible', form).each(function () {
            if (!$(this).val()) {
                $(this).css('border', '1px solid red')
                isValid = false
            }
        })
        $('select:visible', form).each(function () {
            if ($(this).val() == '0') {
                $(this).css('border', '1px solid red')
                isValid = false
            }
        })

        return isValid
    }

    function GetOptionsEnroll() {
        var options = {}
        $('[data-field*="-OPTIONS"]:visible').each(function() {
            var key = $(this).data('field').split('-')[3];
            var value;
            if ($(this).find(':checkbox').length)
                value = $(this).find(':checkbox').prop('checked');
            else if ($(this).find(':radio').length)
                value = $(this).find(':radio:checked').val();
            else
                value = $(this).find('input, textarea, select').val();
            options[key] = value;
        });
        return options;
    }

    function unEnrollTrainee(id) {

        var Trainee = LstTrainees.filter(function (obj) { return parseInt(obj.ID) == id; })
        var price = (parseFloat($("#TotalPrice").html()) || 0) - (parseFloat(Trainee[0].PRICE) || 0);
        $("#TotalPrice").html(price);

        LstTrainees = LstTrainees.filter(function (obj) { return parseInt(obj.ID) !== parseInt(id) });


        $('#Row_' + id).remove();
        if (id == LoggedUserId)
            $("#BtnEnrollMyself").prop("disabled", false); 

        if ($('#BodyTraineeTable tr').length == 0) {
            jQuery('.trainee-table tbody').append('<tr id="Row_initial">' +
            '<td colspan="5" style="text-align: center;">No trainee added</td>' +
            '</tr>');
            $("#BtnValidPreEnroll").prop("disabled", true).removeClass('btn-green-square');
        }
    }

    function ShowPanTraineeError(message) {
        $('#MsgTraineeError').html(message);
        $('#PanTraineeError').show();
    }

    function hidePanAddTrainee() {
        jQuery('#PanAddTrainee').hide();
    }

    function ShowPanTraineeSummary() {
        var formuleIsValid = ValidFormule()
        var transportIsValid = ValidTransport()
        if (ValidForm('FORM_PREENROLL_CLASS', '#pan-new-preenroll') && formuleIsValid && transportIsValid) {
            jQuery('#pan-preenroll-infos').html(GetPreenrollInfo())
            jQuery('#PanTraineeSummary').show();
        }
    }

    function GetPreenrollInfo() {
        var trad = []
        trad['en'] = {
            training: 'Training',
            date: 'Date',
            true: 'Yes',
            false: 'No',
        }
        trad['fr'] = {
            training: 'Formation',
            date: 'Date',
            true: 'Oui',
            false: 'Non',
        }
        var t = trad[moment.locale()] || trad['en']

        var options = GetOptionsEnroll();
        var html = `
            <div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <label>${t.training}</label>
                <div class="form-control">${$('#reserve-training .title').text()}</div>
            </div>`
        if ($('#Txt_-USERS2-EMAIL:visible').length) {
            html += `
            <div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <label>${$('[data-field="-USERS2-EMAIL"]').data('label')}</label>
                <div class="form-control">${$('#Txt_-USERS2-EMAIL:visible').val()}</div>
            </div>`
        }
        html += `
            <div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <label>${t.date}</label>
                <div class="form-control">${$("#LstClassEnroll option:selected").text()}</div>
            </div>`
        
        for (var property in options) {
            var item = $('[data-field*="-OPTIONS-' + property + '"]:visible')
            if (property == 'askTransport') {
                html += `
                <div class="form-group ${(item.data('lg') ? `col-lg-${item.data('lg')} col-md-${item.data('lg')} col-sm-${item.data('lg')} col-xs-${item.data('lg')}` : `col-lg-12 col-md-12 col-sm-12 col-xs-12`)}">
                    <label>${item.data('label')}</label>
                    <div class="form-control">${($('#pan-new-preenroll [name=transport-select]').length ? (!$('#pan-new-preenroll [data-field*="-OPTIONS-askTransport"]:visible :checkbox').prop('checked') ? t['' + $('#pan-new-preenroll [data-field*="-OPTIONS-askTransport"]:visible :checkbox').prop('checked')] : ($('#pan-new-preenroll [name=transport-select]:checked').val() != t.true ? $('#pan-new-preenroll [name=transport-select]:checked').val() : $('#pan-new-preenroll [name=transport-type]:checked').val())) : t['' + $('#pan-new-preenroll [data-field*="-OPTIONS-askTransport"]:visible :checkbox').prop('checked')])}</div>
                </div>`;
            }
            else if (property == 'wantTransport') {

            }
            else if (property == 'passportScan') {
                html += `
                <div class="form-group ${(item.data('lg') ? `col-lg-${item.data('lg')} col-md-${item.data('lg')} col-sm-${item.data('lg')} col-xs-${item.data('lg')}` : `col-lg-12 col-md-12 col-sm-12 col-xs-12`)}">
                    <label>${item.data('label')}</label>
                    <div class="form-control">${$('#pan-new-preenroll [data-field*="-OPTIONS-passportScan"] :text').val()}</div>
                </div>`
            }
            else {
                html += `
                <div class="form-group ${(item.data('lg') ? `col-lg-${item.data('lg')} col-md-${item.data('lg')} col-sm-${item.data('lg')} col-xs-${item.data('lg')}` : `col-lg-12 col-md-12 col-sm-12 col-xs-12`)}">
                    <label>${item.data('label')}</label>
                    <div class="form-control"${(item.data('type') == 2 ? ' style="height: auto"': "")}>${(item.data('type') == 3 ? t['' + options[property]] : (item.data('type') == 12 ? moment(options[property]).format('L') : (options[property] || '').replace(/\n/g, '<br/>')))}</div>
                </div>`
            }
        }
        return html;
    }

    function showPanTrainee() {
        ajaxRequest('GET', '/api/USERS2/' + LoggedUserId).then(function (answerUser) {
            ajaxRequest('GET', '/api/ORGS/' + answerUser.ORG_ID).then(function (answerorg) {
                jQuery('#ButValidPreEnroll').removeAttr('data-myself');
                $('#pan-new-preenroll').after($('#LstClassAvailable').hide());
                ViewForm('FORM_PREENROLL_CLASS', '#pan-new-preenroll', { me: false });

                jQuery('#LstClassEnroll').val(jQuery('#HiClassReserveId').val());
                ajaxRequest('GET', '/api/CLASSES/Model/' + $("#LstClassEnroll option:selected").val()).then(function (oClass) {
                    ajaxRequest('GET', '/api/CLASS_STEP/LIST_STEP/' + $("#LstClassEnroll option:selected").val()).then(function (aClassSteps) {
                        InitViewForm(answerUser, answerorg, oClass, aClassSteps)

                        MyUserId = 0;
                        jQuery('#AddTraineeTitle').text('Add collaborator(s)');
                        jQuery('#PanAddTrainee').show();
                    });
                })
            }, HandlerError);
        }, HandlerError);
    }

    function InitViewForm(answerUser, answerorg, oClass, aClassSteps) {
        var entityType = JSON.parse(answerorg.CUSTOM_FIELD || '{}').ENTITY_TYPE;
        $('LstClassEnroll').prop('disabled', true)
        var hasOutside = aClassSteps.filter(function (step) { return !!step.ROOM && step.ROOM.CODE == 'OUTSIDE' }).length > 0;

        const showFormula = ((entityType == '3' && answerorg.NAME != 'HMFR') || (entityType == '5' && answerorg.NAME != 'SIEMENS')) && oClass.DOMAIN_ID == 2 && !hasOutside

        $('#pan-new-preenroll').prepend(setRgpdInfos())

        if (showFormula) {
            $('#panTransport').append(setTransport(true))
            $('#pan-new-preenroll').append(setFormula())
        }
        else {
            $('#panTransport').append(setTransport(false))
        }

        $('#pan-new-preenroll > div > :checkbox').bootstrapSwitch({
            state: false,
            onText: 'YES',
            offText: 'NO',
            inverse: true,
            onSwitchChange: function (event, state) {
                var panel = $(event.target).closest('[data-field]').data('chk-panel')
                if (panel) {
                    if ($(event.target).prop('checked'))
                        $('#' + panel).slideDown();
                    else
                        $('#' + panel).slideUp();
                }
            },
            onColor: 'impulse',
            size: 'mini'
        });
    }

    function setRgpdInfos() {
        var trad = []
        trad['en'] = {
            rgpd: `By registering to the platform, you agree to our privacy & confidentiality policy:<br/>
The data collected are processed by HORIBA ABX SAS in order to register to HORIBA Medical Digital Training.<br/>
HORIBA ABX SAS, whose head office is located in FRANCE in MONTPELLIER (34 000) - Parc EuromÃ©decine, rue du CaducÃ©e, is the controller and the sole recipient of this data.<br/>
In accordance with the European Data Protection Regulation (EU 2016/679) you have a right of access, opposition and other rights that you may exercise with our Privacy Office (email: privacy.hmfr@horiba.com). You also have the possibility to lodge a complaint with the French data control authority (www.cnil.fr).`,
        }
        trad['fr'] = {
            rgpd: `En vous inscrivant Ã  la plateforme, vous acceptez notre politique de confidentialitÃ© :<br/>
Les donnÃ©es collectÃ©es sont traitÃ©es par HORIBA ABX SAS dans le cadre de l'inscription Ã  HORIBA Medical Digital Training.<br/>
HORIBA ABX SAS, dont le siÃ¨ge social est situÃ© en FRANCE Ã  MONTPELLIER (34 000) - Parc EuromÃ©decine, rue du CaducÃ©e, est le responsable du traitement et le seul destinataire de ces donnÃ©es.<br/>
ConformÃ©ment au rÃ¨glement europÃ©en sur la protection des donnÃ©es (UE 2016/679), vous disposez d'un droit d'accÃ¨s, d'opposition et d'autres droits que vous pouvez exercer auprÃ¨s de notre Privacy Office (email : privacy.hmfr@horiba.com). Vous avez Ã©galement la possibilitÃ© d'introduire une rÃ©clamation auprÃ¨s de la CNIL (www.cnil.fr).`,
        }
        var t = trad[moment.locale()] || trad['en']
        return `<div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12"><div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="font-style:italic; background: #eee; padding: 15px">${t.rgpd}</div></div>`;
    }

    function setTransport(hasFormula) {
        if (hasFormula) {
            var trad = []
            trad['en'] = {
                airport: `Airport`,
                train: `Train`,
                arrival: `Date of arrival`,
                flightNumber: `Flight number`,
                trainNumber: `Train number`,
                trainStation: `Train station`,
                yes: `Yes`,
                no: `No`,
                notYet: `Not yet defined`,
                select: `-- Select --`,
            }
            trad['fr'] = {
                airport: `AÃ©roport`,
                train: `Train`,
                arrival: `Date d'arrivÃ©e`,
                flightNumber: `NumÃ©ro de vol`,
                trainNumber: `NumÃ©ro de train`,
                trainStation: `Gare`,
                yes: `Oui`,
                no: `Non`,
                notYet: `Pas encore dÃ©fini`,
                select: `-- SÃ©lectionner --`,
            }
            var t = trad[moment.locale()] || trad['en']
            const forms = `
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-wantTransport">
                        <label><input type="radio" name="transport-select" value="${t.yes}" event-onclick="$('#form-transport').show()"> ${t.yes}</label>&nbsp;&nbsp;&nbsp;&nbsp;
                        <label><input type="radio" name="transport-select" value="${t.notYet}" event-onclick="$('#form-transport').hide()"> ${t.notYet}</label>
                    </div>
                    <div id="form-transport" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="display:none">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <label><input type="radio" name="transport-type" value="${t.airport}" event-onclick="$('#form-transport-airport').show();$('#form-transport-train').hide()"> ${t.airport}</label>
                            <div id="form-transport-airport" class="row" style="display:none">
                                <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-airportDateArrival" data-label="${t.arrival}" data-type="12" class="item-form form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <label for="airportDateArrival">${t.arrival} *</label>
                                    <input type="date" class="form-control" id="airportDateArrival" placeholder="yyyy-mm-dd" maxlength="10">
                                </div>
                                <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-flightNumber" data-label="${t.flightNumber}" class="item-form form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <label for="flightNumber">${t.flightNumber} *</label>
                                    <input type="text" class="form-control" id="flightNumber">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <label><input type="radio" name="transport-type" value="${t.train}" event-onclick="$('#form-transport-airport').hide();$('#form-transport-train').show()"> ${t.train}</label>
                            <div id="form-transport-train" class="row" style="display:none">
                                <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-trainDateArrival" data-label="${t.arrival}" data-type="12" class="item-form form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <label for="trainDateArrival">${t.arrival} *</label>
                                    <input type="date" class="form-control" id="trainDateArrival" placeholder="yyyy-mm-dd" maxlength="10">
                                </div>
                                <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-trainNumber" data-label="${t.trainNumber}" class="item-form form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <label for="trainNumber">${t.trainNumber} *</label>
                                    <input type="text" class="form-control" id="trainNumber">
                                </div>
                                <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-trainStation" data-label="${t.trainStation}" class="item-form form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <label for="trainStation">${t.trainStation} *</label>
                                    <select class="form-control" id="trainStation">
                                        <option value="0">${t.select}</option>
                                        <option value="Montpellier Station Saint-Roch">Montpellier Station Saint-Roch</option>
                                        <option value="Montpellier Station Sud de France">Montpellier Station Sud de France</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`

            return $(forms)
        }
        else{
            var trad = []
            trad['en'] = {
                arrival: `Date of arrival`,
                departure: `Date of departure`,
                hourArrival: `Hour of arrival`,
                hourDeparture: `Hour of departure`,
            }
            trad['fr'] = {
                arrival: `Date d'arrivÃ©e`,
                departure: `Date de dÃ©part`,
                hourArrival: `Heure d'arrivÃ©e`,
                hourDeparture: `Heure de dÃ©part`,
            }
            var t = trad[moment.locale()] || trad['en']
            const forms = `
                <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-transportDateArrival" data-label="${t.arrival}"class="item-form form-group col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <label for="Txt_panTransport-TRAINING_USER_WAIT-OPTIONS-transportDateArrival">${t.arrival}</label>
                    <input type="date" class="form-control" id="Txt_panTransport-TRAINING_USER_WAIT-OPTIONS-transportDateArrival" placeholder="yyyy-mm-dd" maxlength="10">
                </div>
                <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-transportDateDeparture" data-label="${t.departure}" class="item-form form-group col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <label for="Txt_panTransport-TRAINING_USER_WAIT-OPTIONS-transportDateDeparture">${t.departure}</label>
                    <input type="date" class="form-control" id="Txt_panTransport-TRAINING_USER_WAIT-OPTIONS-transportDateDeparture" placeholder="yyyy-mm-dd" maxlength="10">
                </div>
                <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-transportHourArrival" data-label="${t.hourArrival}" class="item-form form-group col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <label for="Txt_panTransport-TRAINING_USER_WAIT-OPTIONS-transportHourArrival">${t.hourArrival}</label>
                    <input type="time" class="form-control" id="Txt_panTransport-TRAINING_USER_WAIT-OPTIONS-transportHourArrival" placeholder="hh:mm" maxlength="5">
                </div>
                <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-transportHourDeparture" data-label="${t.hourDeparture}" class="item-form form-group col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <label for="Txt_panTransport-TRAINING_USER_WAIT-OPTIONS-transportHourDeparture">${t.hourDeparture}</label>
                    <input type="time" class="form-control" id="Txt_panTransport-TRAINING_USER_WAIT-OPTIONS-transportHourDeparture" placeholder="hh:mm" maxlength="5">
                </div>`

            return $(forms)
        }
    }

    function setFormula() {
        var trad = []
        trad['en'] = {
            formula: `Formula`,
            chooseFormula: `Choose your formula`,
            goGreenDescr: `
                <div class="text-center" style="margin-bottom: 1em"><span class="h1" style="color: white">GO Green</span></div>
                <strong>On arrival at the airport/train station:</strong>
                <ul style="list-style: disc; padding: 1em 2em 0">
                    <li style="margin-bottom: 1em">Transfer by taxi can be organized but is not included in the formula and <strong>is to be paid directly to the driver</strong></li>
                    <li style="margin-bottom: 1em">Partner Hotel near HORIBA Medical</li>
                    <li style="margin-bottom: 1em">Trainee can commute daily by foot or by bus (nÂ°6) to HORIBA Medical training center</li>
                    <li style="margin-bottom: 1em">Daily training</li>
                    <li style="margin-bottom: 1em">Lunches on training days are included</li>
                    <li style="margin-bottom: 1em">Dinner is not included (restaurant and supermarket available around. Town Center accessible by tram nÂ°1).</li>
                    <li style="margin-bottom: 1em">Transfer by taxi back to the airport/train station on the last day can be organized <strong>but is to be paid directly to the driver</strong></li>
                    <li style="margin-bottom: 1em">Invoice* sent to the company</li>
                </ul>
                <div class="text-center">
                    <span class="h2" style="color: white">100â¬/night/trainee*</span>
                    <br />
                    <a href="/AssetsLibrary/Domains/Horiba/livret-formation-go-green.pdf" target="_blank" style="color: white; font-size: inherit; text-decoration: underline; margin-top: 0.5em; display: inline-block">More informations</a>
                </div>
            `,
            goZenDescr: `
                <div class="text-center" style="margin-bottom: 1em"><span class="h1" style="color: white">GO Zen</span></div>
                <strong>On arrival at the airport/train station:</strong>
                <ul style="list-style: disc; padding: 1em 2em 0">
                    <li style="margin-bottom: 1em">Transfer by taxi to our partner hotel in Montpellier Center</li>
                    <li style="margin-bottom: 1em">Every morning after breakfast, taxi fare to Horiba Medical training center</li>
                    <li style="margin-bottom: 1em">Daily training</li>
                    <li style="margin-bottom: 1em">Lunches on training days are included</li>
                    <li style="margin-bottom: 1em">Hotel return by taxi</li>
                    <li style="margin-bottom: 1em">Dinner is not included (restaurant and supermarket available around).</li>
                    <li style="margin-bottom: 1em">Taxi back to the airport/train station on the last day</li>
                    <li style="margin-bottom: 1em">Invoice* sent to the company</li>
                </ul>
                <div class="text-center">
                    <span class="h2" style="color: white">150â¬/night/trainee*</span>
                    <br />
                    <a href="/AssetsLibrary/Domains/Horiba/livret-formation-go-zen.pdf" target="_blank" style="color: white; font-size: inherit; text-decoration: underline; margin-top: 0.5em; display: inline-block">More informations</a>
                </div>
            `,
        }
        trad['fr'] = {
            formula: `Formule`,
            chooseFormula: `Choisissez votre formule`,
            goGreenDescr: `
                <div class="text-center" style="margin-bottom: 1em"><span class="h1" style="color: white">GO Green</span></div>
                <strong>On arrival at the airport/train station:</strong>
                <ul style="list-style: disc; padding: 1em 2em 0">
                    <li style="margin-bottom: 1em">Transfer by taxi can be organized but is not included in the formula and <strong>is to be paid directly to the driver</strong></li>
                    <li style="margin-bottom: 1em">Partner Hotel near HORIBA Medical</li>
                    <li style="margin-bottom: 1em">Trainee can commute daily by foot or by bus (nÂ°6) to HORIBA Medical training center</li>
                    <li style="margin-bottom: 1em">Daily training</li>
                    <li style="margin-bottom: 1em">Lunches on training days are included</li>
                    <li style="margin-bottom: 1em">Dinner is not included (restaurant and supermarket available around. Town Center accessible by tram nÂ°1).</li>
                    <li style="margin-bottom: 1em">Transfer by taxi back to the airport/train station on the last day can be organized <strong>but is to be paid directly to the driver</strong></li>
                    <li style="margin-bottom: 1em">Invoice* sent to the company</li>
                </ul>
                <div class="text-center">
                    <span class="h2" style="color: white">100â¬/night/trainee*</span>
                    <br />
                    <a href="/AssetsLibrary/Domains/Horiba/livret-formation-go-green.pdf" target="_blank" style="color: white; font-size: inherit; text-decoration: underline; margin-top: 0.5em; display: inline-block">More informations</a>
                </div>
            `,
            goZenDescr: `
                <div class="text-center" style="margin-bottom: 1em"><span class="h1" style="color: white">GO Zen</span></div>
                <strong>On arrival at the airport/train station:</strong>
                <ul style="list-style: disc; padding: 1em 2em 0">
                    <li style="margin-bottom: 1em">Transfer by taxi to our partner hotel in Montpellier Center</li>
                    <li style="margin-bottom: 1em">Every morning after breakfast, taxi fare to Horiba Medical training center</li>
                    <li style="margin-bottom: 1em">Daily training</li>
                    <li style="margin-bottom: 1em">Lunches on training days are included</li>
                    <li style="margin-bottom: 1em">Hotel return by taxi</li>
                    <li style="margin-bottom: 1em">Dinner is not included (restaurant and supermarket available around).</li>
                    <li style="margin-bottom: 1em">Taxi back to the airport/train station on the last day</li>
                    <li style="margin-bottom: 1em">Invoice* sent to the company</li>
                </ul>
                <div class="text-center">
                    <span class="h2" style="color: white">150â¬/night/trainee*</span>
                    <br />
                    <a href="/AssetsLibrary/Domains/Horiba/livret-formation-go-zen.pdf" target="_blank" style="color: white; font-size: inherit; text-decoration: underline; margin-top: 0.5em; display: inline-block">More informations</a>
                </div>
            `,
        }
        var t = trad[moment.locale()] || trad['en']

        const forms = `
            <div class="formules form-group col-lg-12 col-md-12 col-sm-12 col-xs-12 clearfix">
                <div class="item-form form-group" style="border-top: #ccc 1px solid; padding-top: 15px;">
                    <label>${t.chooseFormula}</label>
                </div>
                <div id="panFormula">
                    <div data-field="panTransport-TRAINING_USER_WAIT-OPTIONS-formula" data-label="${t.formula}" class="item-form form-group col-lg-6 col-md-6 col-sm-6 col-xs-6 text-center">
                        <div style="display: inline-block; padding: 0.5em 1em 0">
                            <label><input id="formula-zen" type="radio" name="formules" value="GO Zen" event-onclick="$('#formula-go-zen').show();$('#formula-go-green').hide();$(this).closest('div').css('border', '')"> <img src="/AssetsLibrary/Domains/Horiba/go-zen-btn.png" style="margin-right: 15px"></label>
                            <br />
                            <label><input id="formula-green" type="radio" name="formules" value="GO Green" event-onclick="$('#formula-go-zen').hide();$('#formula-go-green').show();$(this).closest('div').css('border', '')"> <img src="/AssetsLibrary/Domains/Horiba/go-green-btn.png" style="margin-right: 15px"></label>
                        </div>
                    </div>
                    <div class="item-form form-group col-lg-6 col-md-6 col-sm-6 col-xs-6">
                        <div id="formula-go-zen" style="background: #008ec3; color: white; border-radius: 4rem; padding: 1.2em; font-size: 1.1em; display: none">
                            ${t.goZenDescr}
                        </div>
                        <div id="formula-go-green" style="background: #89bf5d; color: white; border-radius: 4rem; padding: 1.2em; font-size: 1.1em; display: none">
                            ${t.goGreenDescr}
                        </div>
                    </div>
                </div>
            </div>`

        return $(forms)
    }

    function showTrainingReserve() {
        var tId = jQuery('#HiTrainingReserveId').val();
        var cId = jQuery('#HiClassReserveId').val();

        initStepProgress(4);

        jQuery('#reserve-training .title').empty();
        jQuery('.step-content[data-step-target=1] .content-step-descr').empty();

        $("#Currency").html("EUR");

        ajaxRequest('GET', '../api/TRAINING/' + tId).then(
            function (dTraining) {
                ajaxRequest('GET', '/api/SHEET_TRAINING/' + dTraining.TRAINING_ID + '/' + dTraining.TYPE_TRAINING).then(
                    function (ObjSheet) {
                        jQuery('#reserve-training .title').append(dTraining.NAME);
                        jQuery('#reserve-training .thumb')[0].style.backgroundImage = "url('" + dTraining.IMG_URL + "')";

                        ajaxRequest('GET', '/api/DOMAINs/' + 1).then(
                            function (oDomain) {
                                ajaxRequest('GET', '/api/CURRENCY/' + oDomain.CURRENCY).then(
                                    function (oCurrency) {
                                        $("#Currency").html(oCurrency.SYMBOL);
                                    }
                                );
                            }
                        );

                        ajaxRequest('GET', '/api/CLASSES/Model/' + cId).then(
                            function (oClass) {
                                var NbEnroll = 0;
                                var ObjPlace = 0;

                                if (oClass.CF6 != null && oClass.CF6 != '') {
                                    ObjPlace = JSON.parse(oClass.CF6);
                                    NbPlaceAvailable = parseInt(ObjPlace.NB_STUD_MAX);
                                    ajaxRequestSync('GET', '/api/CLS_USER/GET_ENROLL/' + oClass.CLASS_ID).then(
                                        function (NbE) {
                                            NbEnroll = NbE;
                                        }
                                    );
                                    NbPlaceAvailable = NbPlaceAvailable - NbEnroll;
                                    if (NbPlaceAvailable < 0)
                                        NbPlaceAvailable = 0;
                                }

                                $("#LabNbPlacesAvailable").html(NbPlaceAvailable);
                                $("#TotalPrice").html("0");

                                var datestart = "";
                                if (oClass.DATE_START != null)
                                    datestart = oClass.DATE_START.split('T')[0];

                                var dateend = "";
                                if (oClass.DATE_END != null)
                                    dateend = oClass.DATE_END.split('T')[0];

                                var startDay = datestart.split('-')[2], startMonth = datestart.split('-')[1], startYear = datestart.split('-')[0];
                                var endDay = dateend.split('-')[2], endMonth = dateend.split('-')[1], endYear = dateend.split('-')[0];

                                jQuery('.step-content[data-step-target=1] .content-step-descr').append('<p><label>You have chosen the training: ' + dTraining.NAME + '</label></p>');
                    
                                if (startDay == endDay && startMonth == endMonth && startYear == endYear) {
                                    jQuery('.step-content[data-step-target=1] .content-step-descr').append('<p><label>From:' + moment(oClass.DATE_START).format('LL') + '</label></p><br/>');
                                }
                                else if (startMonth == endMonth && startYear == endYear) {
                                    jQuery('.step-content[data-step-target=1] .content-step-descr').append('<p><label>From  : ' + moment(oClass.DATE_START).format('LL') + '  to ' + moment(oClass.DATE_END).format('LL') + '</label></p><br/>');
                                }
                                else if (startYear == endYear) {
                                    jQuery('.step-content[data-step-target=1] .content-step-descr').append('<p><label>From  : ' + moment(oClass.DATE_START).format('LL') + '  to ' + moment(oClass.DATE_END).format('LL') + '</label></p><br/>');
                                }
                                else {
                                    jQuery('.step-content[data-step-target=1] .content-step-descr').append('<p><label>From  : ' + moment(oClass.DATE_START).format('LL') + '  to ' + moment(oClass.DATE_END).format('LL') + '</label></p><br/>');
                                }

                                jQuery('.step-content[data-step-target=1] .content-step-descr').append('<p><label>For your information, this training deals with the following points: </label></p>');

                                if (ObjSheet.PEDAGO_GOAL != null)
                                {
                                    var $oList = $('<ul/>');
                                    $.each(JSON.parse(ObjSheet.PEDAGO_GOAL), function (i, obj) {
                                        $oList.append($('<li/>').append(obj.TEXT));
                                    });

                                    jQuery('.step-content[data-step-target=1] .content-step-descr').append($oList);
                                }

                                jQuery('#TrainingReserveContentBusiness').data('start', 'setTraining(' + tId + ', ' + cId + ');showTrainingReserve()');

                                jQuery('#TrainingReserveContentBusiness').showContent();
                            }
                        );
                    }
                );
            }
        );
    }

    function initStepProgress(index) {
        var middleStep = 100 / (index * 2);
        jQuery('.steps-progress').css('width', (100 - (middleStep * 2)) + '%').css('margin-left', middleStep + '%');;
        jQuery('.step-progress-line').data('number-of-steps', index).data('now-value', '0').css('width', '0%');
        jQuery('.step-content').hide();
        jQuery('[class*=form-step-].valide').removeClass('valide');
        jQuery('[class*=form-step-].active').removeClass('active');
        jQuery('[class*=form-step-][data-step-target=1]').addClass('active');
        jQuery('.step-content[data-step-target=1]').show();
        jQuery('.step-content input.form-control[type="text"]').val('');
    }

    function setActiveStep(i) {
        if (i === 2 && sessionStorage.getItem(tokenKey) !== null) {
            jQuery('[class*=form-step-][data-step-target=' + i++ + ']').addClass('active');
        }
        if (i === 3 && sessionStorage.getItem(tokenKey) !== null) {
            var tId = jQuery('#HiTrainingReserveId').val();
            $('#LstClassEnroll').prop('disabled', false).find('option').remove().end();

            ajaxRequestSync('GET', '/api/CLASSES/TrainingNotClosedAndPassed/' + tId).then(
            function (ObjLstClass) {
                $.each(ObjLstClass, function (index, ObjClass) {
                    $('#LstClassEnroll').append('<option value="' + ObjClass.CLASS_ID + '">' + moment(ObjClass.DATE_START).format('L') + ' - ' + (ObjClass.CITY || "No place filled") + '</option>');
                });
            });
        }
        if (i === 4 && sessionStorage.getItem(tokenKey) !== null) {
            var classes = {};
            var alreadyEnrolled = []
            var alreadyWaiting = []

            LstTrainees.forEach(function (item) {
                ajaxRequestSync('GET', '/api/CLS_USER/ENROLLED/' + item.CLASS_ID).then(
                    function (enrollIds) {
                        if (enrollIds.indexOf(item.ID) > -1) alreadyEnrolled.push(item.ID)
                    }
                )
            })

            LstTrainees.forEach(function (item) {
                classes.hasOwnProperty(item.CLASS_ID) ? classes[item.CLASS_ID].preenroll++ : (classes[item.CLASS_ID] = { preenroll: 1, valid: true });
                ajaxRequestSync('GET', '/api/CHECK_TRAINING_USER_WAIT/' + item.ID + '/' + item.TRAINING_ID).then(
                    function (isWaiting) {
                        if (isWaiting) alreadyWaiting.push(item.ID)
                    }
                )
            });

            var enroll = true;
            Object.keys(classes).forEach(function (classId) {
                ajaxRequestSync('GET', '/api/CLASSES/Model/' + classId).then(
                    function (oClass) {
                        classes[classId].seats = 0;

                        if (oClass.CF6) {
                            var oSeat = JSON.parse(oClass.CF6);
                            classes[classId].seats = parseInt(oSeat.NB_STUD_MAX);
                        }

                        ajaxRequestSync('GET', '/api/CLS_USER/GET_ENROLL/' + classId).then(
                            function (NbEnroll) {
                                classes[classId].seats -= NbEnroll;
                            }
                        );

                        if (classes[classId].seats - classes[classId].preenroll < 0) {
                            classes[classId].valid = false;
                            enroll = false;
                        }
                    }
                );
            });

            if (enroll) {
                if (alreadyEnrolled.length > 0 || alreadyWaiting.length > 0) {
                    let message = ''

                    if (alreadyEnrolled.length > 0) {
                        let usernames = [];
                        $('.trainee-table').find(alreadyEnrolled.map(user => '#Row_' + user).join(',')).each(function () {
                            usernames.push($(this).find('td:nth(1)').text() + ' ' + $(this).find('td:nth(0)').text());
                        });
                        i--;
                        message += `Collaborators are already enrolled: ${usernames.join(', ')}`
                    }

                    if (alreadyWaiting.length > 0) {
                        let usernames = [];
                        $('.trainee-table').find(alreadyWaiting.map(user => '#Row_' + user).join(',')).each(function () {
                            usernames.push($(this).find('td:nth(1)').text() + ' ' + $(this).find('td:nth(0)').text());
                        });
                        i--;
                        if (message != '')
                            message += '<br/><br/>'
                        message += `Collaborators are already pre-enrolled: ${usernames.join(', ')}`
                    }

                    ShowPanTraineeError(message)
                }
                else {
                    var fd = new FormData();
                    var hasFile = false;
                    LstTrainees.forEach(function (item) {
                        if (document.getElementById('visa_' + item.ID).files[0]) {
                            fd.append("fileToUpload[]", document.getElementById('visa_' + item.ID).files[0]);
                            fd.append("listUsers[]", item.ID);
                            hasFile = true
                        }
                    })

                    var deferred = $.Deferred();
                    if (hasFile)
                        ajaxFileUploadRequest('/api/UploadFile/UploadVisa', fd).then(function (lstUserFiles) {
                            LstTrainees.forEach(function (trainee) {
                                if (lstUserFiles[trainee.ID]) {
                                    var options = JSON.parse(trainee.OPTIONS)
                                    options.passportScan = lstUserFiles[trainee.ID]
                                    trainee.OPTIONS = JSON.stringify(options);
                                }
                            })
                            deferred.resolve()
                        })
                    else
                        deferred.resolve()

                    $.when(deferred).then(function() {
                        ajaxRequestSync('POST', '/api/POST_LST_TRAINING_USER_WAIT', LstTrainees).then(
                            function () {
                                jQuery('.step-content[data-step-target=4] .content-step-success').empty();
                                jQuery('.step-content[data-step-target=4] .content-step-success').append(jQuery('#PanTableTrainee').html());
                                jQuery('.step-content[data-step-target=4] .content-step-success table tbody .OptUnenroll').empty();
                            },
                            function (error) { }
                        );
                    })
                }
            } else {
                var message = '';
                Object.keys(classes).forEach(function (classId) {
                    if (!classes[classId].valid) {
                        message += classes[classId].seats + ' Available seats - ' + classes[classId].seats + ' requested seats - ' + $('#LstClassEnroll option[value="' + classId + '"]').text() + '<br />';
                    }
                });
                i--;
                ShowPanTraineeError(message);
            }
        }
        var actual = parseInt(jQuery('[class*=form-step-].active').data('step-target'));
        if (validateForm(i) || actual > i) {
            jQuery('.step-content[data-step-target=' + actual + ']').hide();
            jQuery('[class*=form-step-].active').addClass('valide').removeClass('active').attr('event-onclick', 'setActiveStep(' + actual + ');');
            jQuery('[class*=form-step-][data-step-target=' + i + ']').addClass('active');
            jQuery('.step-content[data-step-target=' + i + ']').show();
            var step = 100 / (parseInt(jQuery('.step-progress-line').data('number-of-steps')) - 1);
            var t = (i - 1);
            jQuery('.step-progress-line').data('now-value', t * step).css('width', t * step + '%');
        }

        if (actual == 3) {
            $('#reserve-training .form-steps > *').each(function () {
                $(this).removeAttr("onclick");
            })
        }
    }

    function validateForm(i) {
        var bValidOK = true;

        var actual = parseInt(jQuery('[class*=form-step-].active').data('step-target'));

        if (actual == 2) {
            if ($('#TxtNameOrg').val() == '') {
                $('#TxtNameOrg').css('border', '1px red solid');
                bValidOK = false;
            }
            /*if ($('#TxtCodeOrg').val() == '') {
                $('#TxtCodeOrg').css('border', '1px red solid');
                bValidOK = false;
            }*/
            if (bValidOK == false && actual <= i) {
                alert("Please fill in the mandatory fields");
                return false;
            }
        }

        return true;
    }

    function CloseReserveTraining() {
        if (typeof (CloseReserveTrainingClient) !== 'undefined') {
            CloseReserveTrainingClient()
        }
        else {
            showTrainingDetail(jQuery('#HiTrainingReserveId').val());
            LstTrainees = [];
            $("#TotalPrice").html("0");
            jQuery('.step-content[data-step-target=4] .content-step-success').empty();
            jQuery('#PanTableTrainee table tbody').empty();
            jQuery('.trainee-table tbody').append('<tr id="Row_initial"><td colspan="5" style="text-align: center;">No trainee added</td></tr>');
            $("#BtnEnrollMyself").prop("disabled", false);
        }
    }
</script>
</div>


<script nonce="kacyonet" type="text/javascript">

    jQuery(document).ready(function () {        

        jQuery('#hitTarget').val('Portal');
        jQuery('ul.nav.navbar-nav li').click(function () {
            jQuery('#panTrainingDetail').hide();
            jQuery('#panTrainingReserve').hide();
        });

        if(!jQuery.loadContentFromStorage())
            jQuery('#mainContentBusiness').showContent();
    });
    

    function loadConnexion() {
        jQuery('#PanAuthentication').show();
    }
</script>
</div>

                    </div>
                </div>
            </div>
            <div id="footer">
                <footer class="footer">
                    <div class="container">
                        <div style="float: left">
                            <small>&copy; Kacyonet 2020 - 2024 All rights reserved</small>
                        </div>
                        <img src="../images/logo-kacyonet-footer.png" style="float: right;margin-top: 3px" />
                    </div>
                </footer>
            </div>
        </div>


        <div id="PanModalPassword">
	

<div id="modalPWD" class="modal fade password-modal" role="dialog" data-button-default=".btn-primary">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="margin: auto; width: 400px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Change password</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label id="LabActualPWD">Current password</label>
                    <div class="input-group">
                        <input id="TxtActualPWD" type="password" class="form-control" style="border-radius: 4px" autocomplete="off" aria-describedby="ButViewActualPWD" required />
                        <span class="input-group-btn">
                            <button id="ButViewActualPWD" type="button" class="btn btn-link" event-onclick="TogglePWD('TxtActualPWD', 'SpViewActualPWD')"><span id="SpViewActualPWD" class="glyphicon glyphicon-eye-open" style="top: 4px"></span></button>
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <label>New password</label>
                    <div class="help-block" id="PwdHelpBlock"></div>
                    <div class="input-group">
                        <input id="TxtPWD" type="password" class="form-control" style="border-radius: 4px" event-onkeyup="updatePassword()" autocomplete="off" required />
                        <span class="input-group-btn">
                            <button id="ButViewPWD" type="button" class="btn btn-link" event-onclick="TogglePWD('TxtPWD', 'SpViewPWD')"><span id="SpViewPWD" class="glyphicon glyphicon-eye-open" style="top: 4px"></span></button>
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Confirm password</label>
                    <div class="input-group">
                        <input id="TxtConfirmPWD" type="password" class="form-control" style="border-radius: 4px" event-onkeyup="updatePassword()" autocomplete="off" required />
                        <span class="input-group-btn">
                            <button id="ButViewConfirmPWD" type="button" class="btn btn-link" event-onclick="TogglePWD('TxtConfirmPWD', 'SpViewConfirmPWD')"><span id="SpViewConfirmPWD" class="glyphicon glyphicon-eye-open" style="top: 4px"></span></button>
                        </span>
                    </div>
                </div>
                <div id="ConfirmPwdHelpBlock" class="help-block with-errors"></div>
            </div>
            <div class="modal-footer">
                <button id="ButCancelPWD" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button id="ButValidPWD" type="button" class="btn btn-primary" data-type="submit" data-target="#modalPWD" event-onclick="validPWD()">OK</button>
            </div>
        </div>
    </div>
</div>

<script nonce="kacyonet" type="text/javascript">
    function TogglePWD(TxtPWD, SpPWD) {
        $(`#${TxtPWD}`).attr('type', (_, attr) => attr == 'password' ? 'text' : 'password')
        $(`#${SpPWD}`).toggleClass('glyphicon-eye-open glyphicon-eye-close')
    }

    function changePassword() {
        jQuery('.password-modal').modal({ backdrop: true, keyboard: true })
    }

    function validPWD() {
        const pswd = jQuery('#TxtActualPWD').val()
        const newPswd = jQuery('#TxtPWD').val()

        const oLogin = {
            Login: userInfos.LOGINID,
            Password: pswd
        }

        if (pswd != newPswd) {
            ajaxRequest('POST', `${jsRelativePath}api/USERS/ValidLogin`, oLogin).then(
                answerValid => {
                    const oChange = {
                        Password: newPswd,
                        UserId: userInfos.USER_ID
                    }

                    ajaxRequest('POST', `${jsRelativePath}api/USERS/SetPassword`, oChange).then(
                        oUserChanged => {
                            userInfos.DTPASSWORD = oUserChanged.DTPASSWORD
                            jQuery('.password-modal').modal('hide')
                        },
                        error => alert(`An error occurred while processing your request`)
                    )
                },
                error => alert(`The current password entered is incorrect`)
            )
        }
        else {
            alert(`The password entered is identical to the current password`)
        }
    }

    function setPasswordError(arr, cond, text, onlyTrue = false) {
        if (cond)
            arr.push(`<span style="color: #3c763d"><span class="glyphicon glyphicon-ok"></span>&nbsp;${text}</span>`)
        else if (!onlyTrue)
            arr.push(`<span style="color: #a94442"><span class="glyphicon glyphicon-remove"></span>&nbsp;${text}</span>`)
        return cond
    }

    function updatePassword() {
        const pswd = jQuery('#TxtPWD').val()
        const confirm = jQuery('#TxtConfirmPWD').val()
        const errors = []
        const errorsBool = []

        // Au moins 6 caractÃ¨res
        errorsBool.push(setPasswordError(errors, pswd.length >= (domainInfos.LG_PWD || 6), `At least 6 characters`.replace('6', (domainInfos.LG_PWD || 6))))

        // Au moins 1 minuscule et au moins 1 majuscule
        if (domainInfos.ONE_MAJ === 'Y') {
            errorsBool.push(setPasswordError(errors, /[a-z]/.test(pswd), `At least 1 lowercase`))
            errorsBool.push(setPasswordError(errors, /[A-Z]/.test(pswd), `At least 1 capital letter`))
        }

        // Au moins 1 chiffre
        if (domainInfos.ONE_NUMBER === 'Y')
            errorsBool.push(setPasswordError(errors, /\d/.test(pswd), `At least one number`))

        // Au moins 1 caractÃ¨re spÃ©cial (ONE_MINUS => caractÃ¨res spÃ©ciaux)
        if (domainInfos.ONE_MINUS === 'Y')
            errorsBool.push(setPasswordError(errors, /[@#$%^&|!?_\-+*=\.\\]/.test(pswd), `At least 1 special character:&nbsp;@#$%^&|!?_-+*=.\\`))

        jQuery('#PwdHelpBlock').html(errors.join('<br/>'))
        jQuery('#TxtPWD').parent().toggleClass('has-error', !errorsBool.every(val => val === true))

        // Confirmation
        const confirmed = pswd == confirm
        errorsBool.push(confirmed)
        jQuery('#TxtConfirmPWD').parent().toggleClass('has-error', !confirmed)

        jQuery('#ButValidPWD').prop('disabled', !errorsBool.every(val => val === true))
    }

    function testPasswordValidity() {
        ajaxRequest('GET', `${jsRelativePath}api/USERS2/0`).then(answerUser => {
            if (answerUser["DTPASSWORD"] == null) {
                jQuery('#modalPWD .modal-title').html(`New password`)
                jQuery('#LabActualPWD').html(`Temporary password`)
                jQuery('#ButCancelPWD').hide()
                jQuery('.password-modal button.close').hide()
                jQuery('.password-modal').modal({ backdrop: 'static', keyboard: false })
            }
        })
    }

    jQuery(document).ready(() => {
        jQuery('#modalPWD').on('show.bs.modal', function (e) {
            updatePassword()
        })

        jQuery('#modalPWD').on('hidden.bs.modal', function (e) {
            jQuery('#TxtPWD').val('')
            jQuery('#TxtConfirmPWD').val('')
            jQuery('#modalPWD .modal-title').html(`Change password`)
            jQuery('#PwdHelpBlock').html('')
            return false
        })
    })
</script>
</div>
        <div id="PanContact">

</div>

        <script nonce="kacyonet" type="text/javascript">
            jQuery('#navListLang').empty();
            domainInfos.LST_LANGUAGE.filter(function (language) { if (language.LANG_ID !== 2) return language; }).forEach(lang => {
                jQuery('#navListLang').append('<li>' +
                    '<a event-onclick="changeLanguage(' + lang.LANG_ID + ')" >' +
                '<img style="height:20px;margin:5px;" src="../data/flags/' + lang.FLAG + '" alt="' + lang.NAME + '" title="' + lang.NAME + '" />' +
                '<span>' + lang.NAME + '</span>' +
                '</a>' +
                '</li>');
            })

            domainInfos.LST_LANGUAGE.filter(lang => lang.LANG_ID === 2).map(data => { jQuery('#navIconeLang').attr('src', '../data/flags/' + data.FLAG).closest('li').show() })

            function getNotifications() {
                if (jQuery('#navListNotification').length) {
                    var notifications = [];

                    function closeNotification(event) {
                        switch ($(event.currentTarget).data('type')) {
                            case '1':
                                closeTrainingUserWaitNotification(event);
                        }
                        if (jQuery('#navListNotification > li').length == 0)
                            noNotification();
                    }

                    function seenNotification(event) {
                        switch ($(event.currentTarget).data('type')) {
                            case '1':
                                seenTrainingUserWaitNotification(event);
                        }
                    }

                    function noNotification() {
                        jQuery('#navListNotification').append("<li style='padding: 0 15px;'>No notification</li>");
                    }

                    // liste des notifications
                    if (typeof (getTrainingUserWaitNotifications) != 'undefined')
                        notifications = notifications.concat(getTrainingUserWaitNotifications())

                    // tri et affichage
                    if (notifications.length) {
                        notifications
                            .sort(function (a, b) {
                                return a.updatedAt - b.updatedAt;
                            })
                            .forEach(function (item) {
                                jQuery('#navListNotification').append(item.content);
                            });
                        if (jQuery('#navListNotification li.new').length) {
                            jQuery('#navListNotification').prev().css('margin-right', '-10px').find('.badge').text(jQuery('#navListNotification li.new').length);
                        }
                    }
                    else {
                        noNotification();
                    }

                    jQuery('#navListNotification').prev().click(function () {
                        $(this).off('click').find('.badge').css('visibility', 'hidden');
                    })
                    jQuery('#navListNotification')
                        .on('click', 'li', function (event) {
                            event.stopPropagation();
                            if ($(event.target).parent().is($(event.currentTarget).find('button.close')))
                                closeNotification(event);
                        })
                        .on('mouseout', 'li.new', function (event) {
                            seenNotification(event);
                        })
                        .closest('li').show();
                }
            }
            getNotifications();

            function OpenContactModal() {
                jQuery('#ContactModal').modal();

                jQuery('#ContactModal').validator();
                setTimeout(function () { jQuery('#TxtUserMail').focus() }, 500);
            }


            jQuery(function () {
                jQuery(':text:not([value])').val('');
                jQuery('#contentWrapper').show();

                jQuery('[data-toggle="tooltip"]').tooltip();

                jQuery('.fa').css('line-height', 'inherit');

                var l = getUrlParameter('l');
                if (typeof l === "undefined" || l == "") {
                    testPasswordValidity();
                }
            })

            const moxmanrootpath = '/Horiba/datas/files';
        </script>

        <div id="PanControlMove" style="display: none;">
	<div id="ctl14_PanLoadControlSyfadis">

	</div>

<script nonce="kacyonet" type="text/javascript">
    function logout() {
        ajaxRequest('GET', `${jsRelativePath}api/ShortDomain/${(domainInfos.PARENT_ID && domainInfos.PARENT_ID >= 0 ? domainInfos.PARENT_ID : domainInfos.DOMAIN_ID)}`).then(domain => {            
            ajaxRequest('GET', `${jsRelativePath}api/USERS/LOGOUT`).then(() => {
                sessionStorage.removeItem(tokenKey);
                window.location.href = domain.URL
            })
        });
    }

</script>
</div>
    </form>    
</body>
</html>
